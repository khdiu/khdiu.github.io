<!DOCTYPE html>
<html>
  <!-- meta/link... -->
  



<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <!-- Global site tag (gtag.js) - Google Analytics -->


  <title>computer network | khdiu&#39;blog</title>

  <link rel="icon" type="image/png" href="/medias/logo1.png">
  <link rel="stylesheet" href="https://at.alicdn.com/t/font_1911880_c1nvbyezg17.css">
  <link href="https://unpkg.com/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
  <link href="/js/swiper/swiper@5.4.1.min.css" rel="stylesheet">
  
  
  
  
<link rel="stylesheet" href="/css/animate.min.css">

  
<link rel="stylesheet" href="/css/style.css">

  
  
    <link href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.css" rel="stylesheet">
  
  
    
<link rel="stylesheet" href="/js/shareJs/share.min.css">

  
  <style>
        @media (max-width: 992px) {
            #waifu {
                display: none;
            }
        }
    </style>
    <script defer src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">

    
    
    <!-- 依赖于jquery和vue -->
    
        <script src="https://unpkg.com/jquery@3.5.1/dist/jquery.min.js"></script>
    

    
        <script src="https://unpkg.com/vue@2.6.11/dist/vue.min.js"></script>
    

    <!-- import link -->
    
        
            
        
            
        
    
    <!-- import script -->
    
        
            
        
            
        
    

<meta name="generator" content="Hexo 6.0.0"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>

  
  <!-- 预加载动画 -->
  <!-- 页面预加载动画 -->

  
    <div class="preloader_2" id="loader">
  <div class="loader"></div>
</div>

  
<script>
  var endLoading = function () {
    document.body.style.overflow = 'auto';
    document.getElementById('loader').classList.add("loading");
  }
  window.addEventListener('DOMContentLoaded',endLoading);
</script>

  <body>
    <!-- 判断是否为暗黑风格 -->
    <!-- 判断是否为黑夜模式 -->
<script>
  let isDark = JSON.parse(localStorage.getItem('dark')) || JSON.parse('false');

  if (isDark) {
    $(document.body).addClass('darkModel');
  }
</script>

    <!-- 需要在上面加载的js -->
    <script>
  function loadScript(src, cb) {
    return new Promise(resolve => {
      setTimeout(function () {
        var HEAD = document.getElementsByTagName("head")[0] || document.documentElement;
        var script = document.createElement("script");
        script.setAttribute("type", "text/javascript");
        if (cb) {
          if (JSON.stringify(cb)) {
            for (let p in cb) {
              if (p == "onload") {
                script[p] = () => {
                  cb[p]()
                  resolve()
                }
              } else {
                script[p] = cb[p]
                script.onload = resolve
              }
            }
          } else {
            script.onload = () => {
              cb()
              resolve()
            };
          }
        } else {
          script.onload = resolve
        }
        script.setAttribute("src", src);
        HEAD.appendChild(script);
      });
    });
  }

  //https://github.com/filamentgroup/loadCSS
  var loadCSS = function (src) {
    return new Promise(resolve => {
      setTimeout(function () {
        var link = document.createElement('link');
        link.rel = "stylesheet";
        link.href = src;
        link.onload = resolve;
        document.getElementsByTagName("head")[0].appendChild(link);
      });
    });
  };

</script> 

<!-- 轮播图所需要的js -->
<script src="/js/swiper/swiper.min.js"></script>
<script src="/js/swiper/vue-awesome-swiper.js"></script>
<script src="/js/swiper/swiper.animate1.0.3.min.js"></script>

<script type="text/javascript">
  Vue.use(window.VueAwesomeSwiper)
</script>


  <script src="/js/vue-typed-js/index.js"></script>


<!-- 首页的公告滚动插件的js需要重新加载 -->
<script src="/js/vue-seamless-scroll/index.js"></script>

<!-- 打字机效果js -->
<script src="https://unpkg.com/typed.js@2.0.11"></script>


    <div id="safearea">
      <main class="main" id="pjax-container">
        <!-- 头部导航 -->
        
<header class="header  " 
  id="navHeader"
  style="position: fixed;
  left: 0; top: 0; z-index: 10;width: 100%;"
>
  <div class="header-content">
    <div class="bars">
      <div id="appDrawer" class="sidebar-image">
  <div class="drawer-box-icon">
    <i class="fas fa-bars" aria-hidden="true" @click="showDialogDrawer"></i>
  </div>
  
  <transition name="fade">
    <div class="drawer-box_mask" v-cloak style="display: none;" v-show="visible" @click.self="cancelDialogDrawer">
    </div>
  </transition>
  <div class="drawer-box" :class="{'active': visible}">
    <div class="drawer-box-head bg-color">
      <img class="drawer-box-head_logo lazyload placeholder" src="/medias/logo1.png" class="lazyload placeholder" data-srcset="/medias/logo1.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="logo">
      <h3 class="drawer-box-head_title">khdiu&#39;blog</h3>
      <h5 class="drawer-box-head_desc">本站用于记录个人的学习生活之旅途</h5>
    </div>
    
    <div class="drawer-box-content">
      <ul class="drawer-box-content_menu">
        
        
          <li class="drawer-box-content_item">
            <a target="_blank" rel="noopener" href="https://github.com/khdiu">
              <i class="fas fa-github" aria-hidden="true"></i>
              <span>Github</span>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>

<script>
  var body = document.body || document.documentElement || window;
  var vm = new Vue({
    el: '#appDrawer',
    data: {
      visible: false,
      top: 0,
      openArr: [],
    },
    computed: {
    },
    mounted() {
    },
    methods: {
      isOpen(index) {
        if (this.openArr.includes(index)) {
          return true;
        } else {
          return false;
        }
      },
      openOrCloseMenu(curIndex) {
        const index = this.openArr.indexOf(curIndex);
        if (index !== -1) {
          this.openArr.splice(index, 1);
        } else {
          this.openArr.push(curIndex);
        }
      },
      showDialogDrawer() {
        this.visible = true;
        // 防止页面滚动，只能让弹框滚动
        this.top = $(document).scrollTop()
        body.style.cssText = 'width: 100%; height: 100%;overflow: hidden;';
      },
      cancelDialogDrawer() {
        this.visible = false;
        body.removeAttribute('style');
        $(document).scrollTop(this.top)
      }
    },
    created() {}
  })
</script>

    </div>
    <div class="blog-title" id="author-avatar">
      
        <div class="avatar">
          <img src="/medias/logo1.png" class="lazyload placeholder" data-srcset="/medias/logo1.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="logo">
        </div>
      
      <a href="/" class="logo">khdiu&#39;blog</a>
    </div>
    <nav class="navbar">
      <ul class="menu">
        
      </ul>
      
      
        <div id="appSearch">
  <div class="search"  @click="showDialog()"><i class="fas fa-search" aria-hidden="true"></i></div>
  <transition name="fade">
    <div class="message-box_wrapper" style="display: none;" v-cloak v-show="dialogVisible" @click.self="cancelDialogVisible()">
      <div class="message-box animated bounceInDown">
        <h2>
          <span>
            <i class="fas fa-search" aria-hidden="true"></i>
            <span class="title">本地搜索</span>
          </span>
          <i class="fas fa-times close" pointer style="float:right;" aria-hidden="true" @click.self="cancelDialogVisible()"></i>
        </h2>
        <form class="site-search-form">
          <input type="text"
            placeholder="请输入关键字"
            id="local-search-input" 
            @click="getSearchFile()"
            class="st-search-input"
            v-model="searchInput"
          />
        </form>
        <div class="result-wrapper">
          <div id="local-search-result" class="local-search-result-cls"></div>
        </div>
      </div>
    </div>
  </transition>
</div>
<script src="/js/local_search.js"></script>
<script>
  var body = document.body || document.documentElement || window;
  var vm = new Vue({
    el: '#appSearch',
    data: {
      dialogVisible: false,
      searchInput: '',
      top: 0,
    },
    computed: {
    },
    mounted() {
      window.addEventListener('pjax:complete', () => {
        this.cancelDialogVisible();
      })
    },
    methods: {
      showDialog() {
        this.dialogVisible = true;
        // 防止页面滚动，只能让弹框滚动
        this.top = $(document).scrollTop()
        body.style.cssText = 'overflow: hidden;';
      },
      getSearchFile() {
        if (!this.searchInput) {
          getSearchFile("/search.xml");
        }
      },
      cancelDialogVisible() {
        this.dialogVisible = false;
        body.removeAttribute('style');
        $(document).scrollTop(this.top)
      },
    },
    created() {}
  })
</script>
<!-- 解决刷新页面闪烁问题，可以在元素上添加display: none, 或者用vue.extend方法，详情：https://blog.csdn.net/qq_31393401/article/details/81017912 -->
<!-- 下面是搜索基本写法 -->
<!-- <script type="text/javascript" id="local.search.active">
  var inputArea = document.querySelector("#local-search-input");
  inputArea.onclick   = function(){ getSearchFile(); this.onclick = null }
  inputArea.onkeydown = function(){ if(event.keyCode == 13) return false }
</script> -->

      

    </nav>
  </div>
  
    <a target="_blank" rel="noopener" href="https://github.com/khdiu" class="github-corner color-primary" aria-label="View source on GitHub"><svg width="60" height="60" viewBox="0 0 250 250" style="fill:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
  
  
</header>
        <!-- 内容区域 -->
        
 <!-- prismjs 代码高亮 -->
 


<div class="bg-dark-floor" style="position: fixed;left: 0;top: 0;width: 100%;height: 100%;z-index: -1;"></div>


  <!-- 文章详情页顶部图片和标题 -->




<div class="post-detail-header" id="thumbnail_canvas" style="background-repeat: no-repeat; background-size: cover; 
  background-position: center center;position: relative;background-image:url('https://pic2.zhimg.com/80/v2-e22aaad20d20634f506f57fff0fcbc17_1440w.webp')">
  <div class="post-detail-header-mask"></div>
  <canvas id="header_canvas"style="position:absolute;bottom:0;pointer-events:none;"></canvas>
  
  <div class="post-detail-header_info-box">
    <div class="title-box">
      <span class="title">
        computer network
      </span>
    </div>
    
    
      
        <span class="post-detail-header_date">
          <i class="fas fa-calendar"></i> 发表于：2022-02-24 |
        </span>
      

      
        <span class="post-detail-header_categories">
          <i class="iconfont iconbookmark1"></i> 分类：
          
            <a href="/categories/computer-network/" class="post-detail-header_category">
              computer network
            </a>
          
        </span>
      

      
    
  </div>
  
  
    <script src="/js/bubble/bubble.js"></script>
  
</div>





<div class="post-detail-content post-row" 
  style="padding-top: 0px;">
  <div class="main-content">
    <article class="post post-detail">
      <div class="post-content">
        <h1 id="computer-network"><a href="#computer-network" class="headerlink" title="computer network"></a>computer network</h1><h2 id="1-chapter1-computer-networks-and-the-Internet"><a href="#1-chapter1-computer-networks-and-the-Internet" class="headerlink" title="1.chapter1  computer networks and the Internet"></a>1.chapter1  computer networks and the Internet</h2><h3 id="Internet"><a href="#Internet" class="headerlink" title="Internet"></a>Internet</h3><ul>
<li>Internet: “network of networks” Interconnected ISPs</li>
<li>protocols: control sending , receiving of message. TCP,IP,HTTP,Skype</li>
<li>Internet standards:<ul>
<li>RFC: Request for comments</li>
<li>IETF: Internet Engineering task force</li>
</ul>
</li>
<li>Internet: a serve view<ul>
<li>infrastructure that provides services to applications: Web,VoIP,email,games,ecommerce,social nets</li>
</ul>
</li>
</ul>
<h3 id="Protocol"><a href="#Protocol" class="headerlink" title="Protocol"></a>Protocol</h3><p>protocol define format, order of message sent and received among network entities , and actions taken on message transmission ,receipt</p>
<h3 id="1-1network-structure"><a href="#1-1network-structure" class="headerlink" title="1.1network structure"></a>1.1network structure</h3><ul>
<li><p>network edge: </p>
<ul>
<li>hosts: clients and servers </li>
<li>servers often in data centers</li>
</ul>
</li>
<li><p>access networks,physical media:</p>
<p>wired,wireless,communication links</p>
</li>
<li><p>network core :</p>
<ul>
<li>interconnected routers</li>
<li>network of networks</li>
</ul>
</li>
</ul>
<h3 id="1-2network-edge"><a href="#1-2network-edge" class="headerlink" title="1.2network edge"></a>1.2network edge</h3><h4 id="ISP-internet-service-provider"><a href="#ISP-internet-service-provider" class="headerlink" title="ISP(internet service provider)"></a>ISP(internet service provider)</h4><p>End system access the Internet through ISP, such as local cable or telephone companies</p>
<h4 id="Access-networks"><a href="#Access-networks" class="headerlink" title="Access networks"></a>Access networks</h4><ul>
<li>serveral connect methods<ul>
<li>ressidential access nets</li>
<li>institutional nets wnetworks</li>
<li>mobile access networks</li>
</ul>
</li>
</ul>
<ol>
<li><p><strong>DSL(digitl subscriber line)</strong></p>
<ul>
<li>use existing telephone line to central office DSLAM<ul>
<li>data over DSL phone line goes to internet</li>
<li>voice over DSL phone line goes to telephone net</li>
</ul>
</li>
<li><u>&lt;2.5Mbps Upstream rtansmission rate (typically &lt; 1Mbps)</u></li>
<li><u>&lt;24Mbps downstream transmission rate (typically &lt; 10Mbps)</u></li>
</ul>
</li>
<li><p>Cable network</p>
<p>frequency division multiplexing : different channels transmitted in different frequency bands</p>
<ul>
<li><p>HFC: hybrid fiber coax</p>
<p>asymmetric network: <u>30Mbps downstream transmission rate, 2Mbps upstream transmission rate</u></p>
</li>
<li><p>network of cable,fiber attaches homes to ISP router</p>
<ul>
<li>home share access network to cable headend</li>
<li>unlike DSL, which has dedicated access to central office</li>
</ul>
</li>
</ul>
</li>
<li><p>home network: various devices </p>
</li>
<li><p>Ethernet (Enterprise access networks)</p>
<ul>
<li>typically used in companies,universities etc.</li>
<li>10Mbps,100Mbps,1Gbps,10Gbps transmission rates</li>
<li>today,end system typcally connect into Ethernet switch</li>
</ul>
</li>
<li><p>wireless access networks</p>
<ul>
<li>shared wireless access network connects end system to router : via base station aka “access point”</li>
<li><u>Wireless LANs</u><ol>
<li>within building (100ft.)</li>
<li>wifi: 1,54,450Mbps transimission rate</li>
</ol>
</li>
<li><u>wide area wireless access</u><ol>
<li>provided by telco(cellular) operator</li>
<li>between 1 and 10Mbps</li>
<li>3G,4G:LTE</li>
</ol>
</li>
</ul>
</li>
</ol>
<h4 id="sending-message"><a href="#sending-message" class="headerlink" title="sending message"></a>sending message</h4><p>link transmission rate, aka link capacity , aka link bandwidth</p>
<p>packet transmission delay &#x3D; L(bits)&#x2F;R(bits&#x2F;sec)</p>
<h4 id="Physical-media"><a href="#Physical-media" class="headerlink" title="Physical media"></a>Physical media</h4><ul>
<li><p>bit: propagates between transmitter&#x2F;receiver pairs</p>
</li>
<li><p>physical link: what lies between transmitter&amp;receiver</p>
</li>
<li><p>guide media: </p>
<p>signals propagate in solid media: copper,fiber,coax</p>
</li>
<li><p>unguided media</p>
<p>signals propagate freely,ratio</p>
</li>
<li><p>Twisted pair(TP)</p>
<p>two insulated copper wires</p>
<p>category5: 100Mbps,1Gbps Ethernet</p>
<p>category6: 10Gbps</p>
</li>
<li><p><u>coaxial cable</u></p>
<ul>
<li>two concentric copper conductors</li>
<li>bidirectional</li>
<li>broadband<ul>
<li>Mutiple channels on cable</li>
<li>HFC</li>
</ul>
</li>
</ul>
</li>
<li><p>fiber optic cable</p>
<ul>
<li>glass fiber carrying light pulses , each pulse a bit</li>
<li>high-speed operation: high-speed point-to-point ransmission(10’s-100’sGbps transmission rate)</li>
</ul>
</li>
<li><p>lowrer error rate</p>
<ul>
<li>repeaters spaced far apart </li>
<li>immune to electronmagnetic noise</li>
</ul>
</li>
<li><p>radio</p>
<ul>
<li><p>no phsical “wire”  bidirectional </p>
</li>
<li><p>radio link types:</p>
<ol>
<li><p>terrestrial microwave </p>
<p>up to 45Mbps channels</p>
</li>
<li><p>LAN(wifi)</p>
<p>54Mbps</p>
</li>
<li><p>wide area</p>
<p>4G cellular:~10 Mbps</p>
</li>
<li><p>satellite</p>
<ul>
<li>Kbps to 45Mbps channel(or mutiple smaller channels)</li>
<li>270 msec end-to-end delays</li>
<li>geosynchronous versus low altitude</li>
</ul>
</li>
</ol>
</li>
</ul>
</li>
</ul>
<h3 id="1-3network-core"><a href="#1-3network-core" class="headerlink" title="1.3network core"></a>1.3network core</h3><ul>
<li>mesh of interconnected router</li>
<li>packet-switching: hosts break application-layer message into packets<ul>
<li>forward packets form one router to the next ,across links on path from source to destination</li>
<li>each packet transmitted at full link capacity</li>
</ul>
</li>
</ul>
<h4 id="Packet-switch-store-and-forward"><a href="#Packet-switch-store-and-forward" class="headerlink" title="Packet-switch: store-and-forward"></a>Packet-switch: store-and-forward</h4><ul>
<li>It takes L&#x2F;R seconds to transmit L-bit packet into link at R bps</li>
<li>store and forward: entire packet must arrive at router before it can be transmitted on next link</li>
<li>end-end delay &#x3D;2L&#x2F;R(assuming zero propagation delay)</li>
</ul>
<h4 id="Packet-switching-queueing-delaying-loss"><a href="#Packet-switching-queueing-delaying-loss" class="headerlink" title="Packet-switching: queueing delaying,loss"></a>Packet-switching: queueing delaying,loss</h4><p>if arrival rate(in bits)to link exceeds transmission rate of link for a period of time:</p>
<ul>
<li>packets will queue, wait to be transimitted on link </li>
<li>packets can be dropped(lost) if memory(buffers) fills up</li>
</ul>
<h4 id="Tow-key-network-core-functions"><a href="#Tow-key-network-core-functions" class="headerlink" title="Tow key network-core functions"></a>Tow key network-core functions</h4><ul>
<li>routing: determines source-destination route taken by packets</li>
<li>forwarding: move packets from router’ input to appropriate router ouput</li>
</ul>
<h4 id="Alternative-core-circuit-switching"><a href="#Alternative-core-circuit-switching" class="headerlink" title="Alternative core: circuit switching"></a>Alternative core: circuit switching</h4><p>end-end resources allocated to,reserved for “call” between source&amp;destination</p>
<ul>
<li><p>in diagram, each links has four circuits </p>
<p>call gets 2nd circuit in top link and 1st circuit in right link</p>
</li>
<li><p>dedicated resources: no sharing</p>
<p>circuit-like(guaranteed) performance</p>
</li>
<li><p>circuit segment idle if not used by call(no sharing)</p>
</li>
<li><p>commonly used in traditional telephone networks</p>
</li>
</ul>
<h4 id="FDM-versus-TDM"><a href="#FDM-versus-TDM" class="headerlink" title="FDM versus TDM"></a>FDM versus TDM</h4><p>FDM: frequency-division multiplexing</p>
<p>TDM: time-division multiplexing</p>
<ul>
<li>With FDM each circuit continuously gets a fraction of the bandwidth</li>
<li>With TDM each circuit gets all of the bandwidth periodically during brief of time</li>
</ul>
<h4 id="Packet-switching-versus-circuit-switching"><a href="#Packet-switching-versus-circuit-switching" class="headerlink" title="Packet switching versus circuit switching"></a>Packet switching versus circuit switching</h4><ul>
<li><p>Packet switching </p>
<p>Advantages:</p>
<ul>
<li>great for bursty data</li>
<li>resource sharing</li>
<li>simpler, no call set up</li>
</ul>
<p>excessive congestion possible: </p>
<ul>
<li>packet delay and loss</li>
<li>protocols needed for reliable data transfer, congestion control</li>
</ul>
</li>
<li><p>circuit switching </p>
<ul>
<li>bandwidth guarantees needed for audio&#x2F;video apps</li>
<li>still an unsolved problem(chapter 7)</li>
</ul>
</li>
</ul>
<h4 id="Internet-structure-network-of-networks"><a href="#Internet-structure-network-of-networks" class="headerlink" title="Internet structure: network of networks"></a>Internet structure: network of networks</h4><ul>
<li>End-system connect to the access ISP</li>
<li>access ISP connect to the regional ISP </li>
<li>regional access connect to tier ISP</li>
</ul>
<h3 id="1-4Delay-loss-and-throughput-in-packet-switched-Networks"><a href="#1-4Delay-loss-and-throughput-in-packet-switched-Networks" class="headerlink" title="1.4Delay,loss,and throughput in packet-switched Networks"></a>1.4Delay,loss,and throughput in packet-switched Networks</h3><h4 id="Delay"><a href="#Delay" class="headerlink" title="Delay:"></a>Delay:</h4><img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220228233531690.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220228233531690.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" style="zoom:50%;">

<ul>
<li><p>Processing delay (<u>this relates to router’s cycle of instruction</u>) (constant)</p>
<p>The time required to examine the packet’s header and determine where to direct the part</p>
<p>Processing delays in high-speed routers are typically on the order of microseconds or less</p>
<p><u>After this nodal processing, the router directs the packet to the queue that precedes the links to router B</u> </p>
</li>
<li><p>Queuing delay (variable)</p>
<p>The time it waits to be transmitted onto the link.</p>
<p>This can be on the order of microseconds to milliseconds in practice</p>
</li>
<li><p>Transmission delay (constant)</p>
<p>This can be different in various way </p>
<p>Typically , the first-come-first-served manner, the delay formula is</p>
<p><strong>D(delay)&#x3D;L(Packet length)&#x2F;R(link bandwidth)</strong></p>
<p>Transmission delays are typically on the order of microseconds to milliseconds in practice</p>
</li>
<li><p>Propagation delay (constant)</p>
<p>The time required to propagate from the beginning of the link to router B </p>
<p>This propagation speed is the range of </p>
<p><strong>2<em>10^8 meter&#x2F;sec to 3</em>10^8 meters&#x2F;sec</strong></p>
<p>The formula is</p>
<p><strong>D(delay)&#x3D;d(length of physical link)&#x2F;s(propagation speed)</strong></p>
</li>
</ul>
<p><strong>link : the device transform the digital signal to the analog signal</strong></p>
<p><strong>relay device: the intermedium device transmit the analog signal</strong>  </p>
<h4 id="Queuing-delay-and-packet-loss"><a href="#Queuing-delay-and-packet-loss" class="headerlink" title="Queuing delay and packet loss"></a>Queuing delay and packet loss</h4><ul>
<li><p>Queuing delay:</p>
<p>traffic intensity: terminology to describe the congestion of the queue</p>
<p>The fofmula:</p>
<p><strong>Traffic intensity &#x3D; L*a&#x2F;R</strong></p>
<p>L:Per packet consists of L bits data</p>
<p>a:Average rate of link packets arrive the queue (packets&#x2F;sec)</p>
<p>R:The rate at witch bits are pushed out the queue (bits&#x2F;sec)</p>
</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220228233646419.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220228233646419.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220228233646419" style="zoom:50%;">

<ul>
<li><p>Packet loss</p>
<p>Queue preceding link n buffer has finite capacity</p>
<p>packet arriving to full queue dropped </p>
<p>lost packet may be retransmitted by previous node, by source end system, or not at all</p>
</li>
</ul>
<h4 id="Throughput"><a href="#Throughput" class="headerlink" title="Throughput"></a>Throughput</h4><p>The rate(bits&#x2F;time unit) at witch bits transferred between sender and receiver</p>
<ul>
<li><p>instantaneous: rate at given point in time</p>
</li>
<li><p>average: rate over longer period of time</p>
</li>
<li><p>The formula for throughput</p>
<p><strong>The bottleneck link: The minimal transmission rate of witch router has in the entire network</strong></p>
<ul>
<li>throughput &#x3D; min{Rs,Rc} only client and server</li>
<li>throughut &#x3D; min {R1,R2,…,Rn,Rs,Rc} include other routers</li>
<li>throughput &#x3D; min{R1,R2,…,Rn,Rs,Rc,R(<u>bottleneck&#x2F;users</u>)} multiple users sharing one network</li>
</ul>
</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220228233249932.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220228233249932.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" style="zoom:50%;">



<h3 id="1-5Protocol-layers-service-models"><a href="#1-5Protocol-layers-service-models" class="headerlink" title="1.5Protocol layers, service models"></a>1.5Protocol layers, service models</h3><h4 id="Layers"><a href="#Layers" class="headerlink" title="Layers:"></a>Layers:</h4><p> Each layer implements a service</p>
<ul>
<li>via its own internal-layer actions</li>
<li>relying on services provides by layer below</li>
</ul>
<p>dealing with complex systems:</p>
<ul>
<li>explicit structure allows identification, relationship of complex system’s pieces<ul>
<li>layered reference model for discussion</li>
</ul>
</li>
<li>modularization eases maintenance, updating of system<ul>
<li>change of implementation of layers’ service transparent to rest of system</li>
<li>change in gate procedure doesn’t affect rest of system</li>
</ul>
</li>
</ul>
<p><strong>Internet protocol stack</strong> (From bottom to top)</p>
<ul>
<li><p>Application: supporting network applications</p>
<p>FTP,SMTP,HTTP</p>
</li>
<li><p>Transport: process-process data transfer</p>
<p>TCP(typical),UDP(no-frills)</p>
</li>
<li><p>Network: the routing of datagrams from source to destination</p>
<p>IP,routing protocol</p>
</li>
<li><p>link: data transfer between neighboring network elements</p>
<p>Ethernet,Wifi,PPP</p>
</li>
<li><p>physical: bits “on the wire”</p>
</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220228231507652.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220228231507652.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" style="zoom: 33%;">



<p><strong>IOS&#x2F;OSI reference model</strong></p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220301205238242.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220301205238242.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220301205238242" style="zoom:50%;">



<ul>
<li>presentation: allow applications to interpret meaning of data, encryption, compression, machine-specific conventions</li>
<li>session: synchronization, checkpointing, recovery of data exchange</li>
</ul>
<p><strong>Internet stack “missing” these layers!</strong></p>
<p>these services, if needed, must be implemented in application</p>
<h4 id="Encapsulation"><a href="#Encapsulation" class="headerlink" title="Encapsulation:"></a>Encapsulation:</h4><ul>
<li>Application: append message</li>
<li>transport: append segment</li>
<li>network: append datagram</li>
<li>link: append frame</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220228231927492.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220228231927492.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" style="zoom: 50%;">

<p>Typically, switch only has link and physical layers, no network layer ,witch means it doesn’t have IP address and cannot be found by uesers </p>
<p><strong>PDU: Each layer in protocol stack, except layer-1(physical), has its PDU(protocol data unit)</strong></p>
<p><strong>Data + header &#x3D; PDU</strong></p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220228232827461.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220228232827461.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" style="zoom: 50%;">

<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220301211157835.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220301211157835.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220301211157835" style="zoom:50%;">



<ul>
<li>Application-layer-<strong>message</strong>: Exchange of packet information</li>
<li>Transport-layer-<strong>segment</strong>: Appending <strong><u>additional information</u></strong>(so-called transport-layer header information, the added information may include information allowing the receiver-side transport layer to deliver the message up to the appropriate application, and error detection bits which show whether the message have been changed), which will be used by the receiver-side transport-layer, <strong><u>the message and header comprise of segment</u></strong></li>
<li>Network-layer-<strong>datagram</strong>: Appending network-layer header, such as source and destination end system address, creating a <strong><u>datagram</u></strong></li>
<li>Link-layer-frame: appending linked-layer header</li>
<li>Each packet has two type of fields: header and payload(A packet form the layer above)</li>
</ul>
<h2 id="Homework1-supplements-（extension-and-correct）"><a href="#Homework1-supplements-（extension-and-correct）" class="headerlink" title="Homework1 supplements （extension and correct）"></a>Homework1 supplements （extension and correct）</h2><ul>
<li>NAT(Network Address Transmission)</li>
<li>A router equipped with NAT software is called a NAT router and has at least one valid external global IP address (public IP address)</li>
<li>Host &#x3D; end system; end system &#x3D; clients + server (page 11)</li>
<li>Two nodes in the internet are connected together by communication links</li>
<li>socket: A interface that specifies how a program running on one end system asks the internet infrastructure to deliver data to a specific destination program running on other end system</li>
<li>FDDI(Fiber Distributed Data Interface): typically used in area network(campus network)</li>
<li>Two types of packet-switch network: datagram networks and virtual-circuit networks<ul>
<li>virtual-circuit: no destination code, just have a virtual code(int, witch points the next Router), then, a virtual circuit are constructed, the transmission direction has been fixed.</li>
</ul>
</li>
<li>There is no congestion in a circuit switching network</li>
<li>The drawbacks of message segmentation(packet-switch): <ul>
<li>Packets have to be put in sequence at the destination </li>
<li>Message segmentation results in many smaller packets. Since header size is usually the same for all packets regardless of their size, with message segmentation the total amount of header bytes is more</li>
</ul>
</li>
</ul>
<h2 id="2-chaper2-Application-layer"><a href="#2-chaper2-Application-layer" class="headerlink" title="2. chaper2 Application layer"></a>2. chaper2 Application layer</h2><h3 id="Outline"><a href="#Outline" class="headerlink" title="Outline:"></a>Outline:</h3><p>2.1 principles of network applications</p>
<p>2.2 Web and HTTP</p>
<p>2.3 electronic mail</p>
<ul>
<li>SMTP, POP3, IMAP</li>
</ul>
<p>2.4 DNS</p>
<p>2.5 P2P applications</p>
<p>2.6 video streaming and </p>
<ul>
<li>content distribution </li>
<li>networks</li>
</ul>
<p>2.7 socket programming </p>
<ul>
<li>with UDP and TCP</li>
</ul>
<h3 id="2-1-principles-of-network-applications"><a href="#2-1-principles-of-network-applications" class="headerlink" title="2.1 principles of network applications"></a>2.1 principles of network applications</h3><h4 id="2-1-1-Goals："><a href="#2-1-1-Goals：" class="headerlink" title="2.1.1 Goals："></a>2.1.1 Goals：</h4><ul>
<li><p>conceptual,  implementation aspects  of network application  protocols</p>
<ul>
<li>transport-layer  </li>
<li>service models </li>
<li>client-server paradigm </li>
<li>peer-to-peer paradigm </li>
<li>content distribution networks</li>
</ul>
</li>
<li><p>learn about protocols by  examining popular  application-level  protocols</p>
<ul>
<li>HTTP </li>
<li>FTP </li>
<li>SMTP &#x2F; POP3 &#x2F; IMAP </li>
<li>DNS</li>
</ul>
</li>
<li><p>creating network</p>
<ul>
<li>socket API</li>
</ul>
</li>
</ul>
<h4 id="2-1-2-Creating-a-network-app"><a href="#2-1-2-Creating-a-network-app" class="headerlink" title="2.1.2 Creating a network app"></a>2.1.2 Creating a network app</h4><p><strong>write programs that:</strong></p>
<ul>
<li>run on (different) end systems</li>
<li>communicate over network</li>
<li>e.g., web server software  communicates with browser  software</li>
</ul>
<p><strong>no need to write software  for network-core devices</strong></p>
<ul>
<li>network-core devices do not  run user applications</li>
<li>applications on end systems  allows for rapid app  development, propagation</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326165226295.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326165226295.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220326165226295" style="zoom: 50%;">

<h4 id="2-1-3-Application-architectures"><a href="#2-1-3-Application-architectures" class="headerlink" title="2.1.3 Application architectures"></a>2.1.3 Application architectures</h4><p>possible structure of applications: </p>
<ul>
<li>client-server </li>
<li>peer-to-peer (P2P)</li>
</ul>
<h4 id="2-1-4-Client-server-architecture"><a href="#2-1-4-Client-server-architecture" class="headerlink" title="2.1.4 Client-server architecture"></a>2.1.4 Client-server architecture</h4><p>server: </p>
<ul>
<li>always-on host </li>
<li>permanent IP address </li>
<li>data centers for scaling</li>
</ul>
<p>clients:</p>
<ul>
<li>Communicate with server </li>
<li>May be intermittently connected </li>
<li>May have dynamic IP addresses </li>
<li>Do not communicate directly with each other</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326165647217.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326165647217.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220326165647217" style="zoom:50%;">



<h4 id="2-1-5-P2P-architecture"><a href="#2-1-5-P2P-architecture" class="headerlink" title="2.1.5 P2P architecture"></a>2.1.5 P2P architecture</h4><ul>
<li>no always-on server </li>
<li>arbitrary end systems directly communicate </li>
<li>peers request service from other peers, provide service in return to other peers </li>
<li>self scalability – new peers bring new service capacity, as well as new  service demands </li>
<li>peers are intermittently connected and change IP addresses <ul>
<li>complex management</li>
</ul>
</li>
</ul>
<h4 id="2-1-6-Processes-communicating"><a href="#2-1-6-Processes-communicating" class="headerlink" title="2.1.6 Processes communicating"></a>2.1.6 Processes communicating</h4><ul>
<li><p>process: program running  within a host</p>
<ul>
<li>within same host, two processes communicate using inter-process communication (defined by  OS) </li>
<li>processes in different hosts communicate by exchanging messages</li>
</ul>
</li>
<li><p>aside: applications with P2P architectures have client processes &amp; server processes</p>
</li>
</ul>
<h4 id="2-1-7-Sockets"><a href="#2-1-7-Sockets" class="headerlink" title="2.1.7 Sockets"></a>2.1.7 Sockets</h4><ul>
<li>process sends&#x2F;receives messages to&#x2F;from its socket </li>
<li>socket analogous to door <ul>
<li>sending process shoves message out door </li>
<li>sending process relies on transport infrastructure on other side of door to deliver message to socket at receiving process</li>
</ul>
</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326170347226.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326170347226.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220326170347226" style="zoom:67%;">

<h4 id="2-1-8-Addressing-processes"><a href="#2-1-8-Addressing-processes" class="headerlink" title="2.1.8 Addressing processes"></a>2.1.8 Addressing processes</h4><ul>
<li>to receive messages, process must have identifier </li>
<li>host device has unique 32- bit IP address </li>
<li>Q: does IP address of host  on which process runs suffice for identifying the process?<ul>
<li>A: no, many processes  can be running on same host</li>
</ul>
</li>
<li>identifier includes both IP address and port numbers associated with process on host</li>
<li>example port numbers: <ul>
<li>HTTP server: 80 </li>
<li>mail server: 25</li>
</ul>
</li>
<li>to send HTTP message to gaia.cs.umass.edu web  server: <ul>
<li>IP address: 128.119.245.12 </li>
<li>port number: 80</li>
</ul>
</li>
</ul>
<h4 id="2-1-9App-layer-protocol-defines"><a href="#2-1-9App-layer-protocol-defines" class="headerlink" title="2.1.9App-layer protocol defines"></a>2.1.9App-layer protocol defines</h4><ul>
<li>types of messages  exchanged<ul>
<li>e.g., request, response</li>
</ul>
</li>
<li>message syntax:<ul>
<li>hat fields in messages  &amp; how fields are  delineated</li>
</ul>
</li>
<li>message semantics<ul>
<li>meaning of information  in fields</li>
</ul>
</li>
<li>rules for when and how  processes send &amp; respond  to messages</li>
<li>open protocols:<ul>
<li>defined in RFCs </li>
<li>allows for interoperability </li>
<li>e.g., HTTP, SMTP</li>
</ul>
</li>
<li>proprietary protocols: <ul>
<li>e.g., Skype</li>
</ul>
</li>
</ul>
<h4 id="2-1-10-What-transport-service-does-an-app-need"><a href="#2-1-10-What-transport-service-does-an-app-need" class="headerlink" title="2.1.10 What transport service does an app need?"></a>2.1.10 What transport service does an app need?</h4><ul>
<li><h5 id="data-integrity"><a href="#data-integrity" class="headerlink" title="data integrity"></a>data integrity</h5><ul>
<li>some apps (e.g., file transfer, web transactions) require 100% reliable data transfer </li>
<li>other apps (e.g., audio) can tolerate some loss</li>
</ul>
</li>
<li><p>timing </p>
<ul>
<li>some apps (e.g., Internet telephony, interactive games) require low delay to be “effective”</li>
</ul>
</li>
<li><p>throughput </p>
<ul>
<li>some apps (e.g., multimedia) require minimum amount of throughput to be “effective” </li>
<li>other apps (“elastic apps”) make use of whatever throughput they get</li>
</ul>
</li>
</ul>
<h4 id="2-1-11-Transport-service-requirements-common-apps"><a href="#2-1-11-Transport-service-requirements-common-apps" class="headerlink" title="2.1.11 Transport service requirements: common apps"></a>2.1.11 Transport service requirements: common apps</h4><img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326171736908.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326171736908.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220326171736908" style="zoom:50%;">

<h4 id="2-1-12-Internet-transport-protocols-services"><a href="#2-1-12-Internet-transport-protocols-services" class="headerlink" title="2.1.12 Internet transport protocols services"></a>2.1.12 Internet transport protocols services</h4><ul>
<li><p>TCP service: </p>
<ul>
<li>reliable transport between sending and receiving process </li>
<li>flow control: sender won’ t overwhelm receiver </li>
<li>congestion control: throttle sender when network overloaded </li>
<li>does not provide: timing, minimum throughput guarantee, security </li>
<li>connection-oriented: setup required between client and server processes</li>
</ul>
</li>
<li><p>UDP service: </p>
<ul>
<li>unreliable data transfer between sending and receiving process </li>
<li>does not provide: reliability, flow control, congestion control, timing, throughput guarantee, security, or connection setup</li>
</ul>
</li>
</ul>
<h4 id="2-1-13-Internet-apps-application-transport-protocols"><a href="#2-1-13-Internet-apps-application-transport-protocols" class="headerlink" title="2.1.13 Internet apps: application, transport protocols"></a>2.1.13 Internet apps: application, transport protocols</h4><img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326172120563.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326172120563.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220326172120563" style="zoom:50%;">

<h4 id="2-1-14-Securing-TCP"><a href="#2-1-14-Securing-TCP" class="headerlink" title="2.1.14 Securing TCP"></a>2.1.14 Securing TCP</h4><ul>
<li><p>TCP &amp; UDP  </p>
<ul>
<li><p>no encryption </p>
</li>
<li><p>cleartext passwords sent into socket traverse Internet in cleartext</p>
</li>
</ul>
</li>
<li><p>SSL </p>
<ul>
<li>provides encrypted TCP  connection </li>
<li>data integrity </li>
<li>end-point authentication</li>
</ul>
</li>
<li><p>SSL is at app layer </p>
<ul>
<li>apps use SSL libraries, that  “talk” to TCP</li>
</ul>
</li>
<li><p>SSL socket API </p>
<ul>
<li><p>cleartext passwords sent into socket traverse Internet encrypted  </p>
</li>
<li><p>see Chapter 8</p>
</li>
</ul>
</li>
</ul>
<h3 id="2-2-Web-and-HTTP"><a href="#2-2-Web-and-HTTP" class="headerlink" title="2.2 Web and HTTP"></a>2.2 Web and HTTP</h3><h4 id="2-2-1-Preview"><a href="#2-2-1-Preview" class="headerlink" title="2.2.1 Preview"></a>2.2.1 Preview</h4><ul>
<li>web page consists of objects </li>
<li>object can be HTML file, JPEG image, Java applet,  udio file,… </li>
<li>web page consists of base HTML-file which includes several referenced objects </li>
<li>each object is addressable by a URL, e.g.</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326173006283.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326173006283.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220326173006283" style="zoom:50%;">



<h4 id="2-2-2-HTTP-overview"><a href="#2-2-2-HTTP-overview" class="headerlink" title="2.2.2 HTTP overview"></a>2.2.2 HTTP overview</h4><p>HTTP: hypertext transfer protocol</p>
<ul>
<li>Web’s application layer protocol </li>
<li>client&#x2F;server model <ul>
<li>client: browser that requests, receives, (using HTTP protocol) and “displays” Web objects </li>
<li>server: Web server sends (using HTTP  protocol) objects in response to requests</li>
</ul>
</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326173142865.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326173142865.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220326173142865" style="zoom:50%;">

<ul>
<li>uses TCP: <ul>
<li>client initiates TCP connection (creates  socket) to server, port 80 </li>
<li>server accepts TCP connection from client </li>
<li>HTTP messages (application-layer protocol messages) exchanged between browser (HTTP client) and Web server (HTTP server) </li>
<li>TCP connection closed</li>
</ul>
</li>
<li>HTTP is “stateless” <ul>
<li>server maintains no information about past client requests</li>
</ul>
</li>
</ul>
<p>aside:</p>
<ul>
<li>protocols that maintain “ state ” are complex! <ul>
<li>past history (state) must be maintained </li>
<li>if server&#x2F;client crashes, their views of “ state ” may be  inconsistent, must be reconciled</li>
</ul>
</li>
</ul>
<h4 id="2-2-3-HTTP-connections"><a href="#2-2-3-HTTP-connections" class="headerlink" title="2.2.3 HTTP connections"></a>2.2.3 HTTP connections</h4><ul>
<li>non-persistent HTTP<ul>
<li>at most one object sent over TCP connection <ul>
<li>connection then closed</li>
</ul>
</li>
<li>downloading multiple objects required multiple connections</li>
</ul>
</li>
<li>persistent HTTP<ul>
<li>multiple objects can be sent over single TCP connection between client, server</li>
</ul>
</li>
</ul>
<h5 id="Non-persistent-HTTP"><a href="#Non-persistent-HTTP" class="headerlink" title="Non-persistent HTTP"></a><strong>Non-persistent HTTP</strong></h5><p>suppose user enters URL:</p>
<p><a target="_blank" rel="noopener" href="http://www.someschool.edu/someDepartment/home.index">http://www.someschool.edu/someDepartment/home.index</a></p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326174540188.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326174540188.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220326174540188" style="zoom:50%;">

<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326174551021.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326174551021.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220326174551021" style="zoom:50%;">



<h5 id="Non-persistent-HTTP-response-time"><a href="#Non-persistent-HTTP-response-time" class="headerlink" title="Non-persistent HTTP: response time"></a>Non-persistent HTTP: response time</h5><p>RTT (definition): time for a small packet to travel from client to server and back</p>
<p>HTTP response time:</p>
<ul>
<li>one RTT to initiate TCP connection </li>
<li>one RTT for HTTP request and first few bytes of HTTP response to return </li>
<li>file transmission time</li>
<li>non-persistent HTTP  response time &#x3D; 2RTT + file transmission time</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326174807388.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326174807388.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220326174807388" style="zoom:50%;">

<h5 id="Persistent-HTTP"><a href="#Persistent-HTTP" class="headerlink" title="Persistent HTTP"></a>Persistent HTTP</h5><ul>
<li>non-persistent HTTP issues: <ul>
<li>requires 2 RTTs per object </li>
<li>OS overhead for each TCP connection </li>
<li>browsers often open parallel TCP connections to fetch referenced objects</li>
</ul>
</li>
<li>persistent HTTP: <ul>
<li>server leaves connection open after sending response </li>
<li>subsequent HTTP  messages between same client&#x2F;server sent over open connection </li>
<li>client sends requests as  soon as it encounters a referenced object </li>
<li>as little as one RTT for all the referenced objects</li>
</ul>
</li>
</ul>
<h4 id="2-2-4-HTTP-request-message"><a href="#2-2-4-HTTP-request-message" class="headerlink" title="2.2.4 HTTP request message"></a>2.2.4 HTTP request message</h4><ul>
<li>two types of HTTP messages: request, response </li>
<li>HTTP request message: <ul>
<li>ASCII (human-readable format)</li>
</ul>
</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326175056578.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326175056578.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220326175056578" style="zoom:50%;">

<h5 id="HTTP-request-message-general-format"><a href="#HTTP-request-message-general-format" class="headerlink" title="HTTP request message: general format"></a>HTTP request message: general format</h5><img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326175225959.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326175225959.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220326175225959" style="zoom:50%;">

<h5 id="Uploading-form-input"><a href="#Uploading-form-input" class="headerlink" title="Uploading form input"></a>Uploading form input</h5><ul>
<li><p>POST method: </p>
<ul>
<li><p>web page often includes form input </p>
</li>
<li><p>input is uploaded to server in entity body</p>
</li>
</ul>
</li>
<li><p>URL method: </p>
<ul>
<li>uses GET method </li>
<li>input is uploaded in URL field of request line:</li>
</ul>
</li>
</ul>
<h5 id="Method-types"><a href="#Method-types" class="headerlink" title="Method types"></a>Method types</h5><ul>
<li>HTTP&#x2F;1.0: <ul>
<li>GET</li>
<li>POST </li>
<li>HEAD <ul>
<li>asks server to leave requested object out of response</li>
</ul>
</li>
</ul>
</li>
<li>HTTP&#x2F;1.1: <ul>
<li>GET, POST, HEAD </li>
<li>PUT <ul>
<li>uploads file in entity body to path specified  in URL field</li>
</ul>
</li>
<li>DELETE <ul>
<li>deletes file specified in the URL field</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="2-2-5-HTTP-response-message"><a href="#2-2-5-HTTP-response-message" class="headerlink" title="2.2.5 HTTP response message"></a>2.2.5 HTTP response message</h4><img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326175647911.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326175647911.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220326175647911" style="zoom:50%;">

<h5 id="HTTP-response-status-codes"><a href="#HTTP-response-status-codes" class="headerlink" title="HTTP response status codes"></a>HTTP response status codes</h5><ul>
<li>status code appears in 1st line in server-toclient response message.</li>
<li>some sample codes:<ul>
<li>200 OK <ul>
<li>request succeeded, requested object later in this msg</li>
</ul>
</li>
<li>301 Moved Permanently <ul>
<li>requested object moved, new location specified later in this msg (Location:)</li>
</ul>
</li>
<li>400 Bad Request <ul>
<li>request msg not understood by server</li>
</ul>
</li>
<li>404 Not Found <ul>
<li>requested document not found on this server</li>
</ul>
</li>
<li>505 HTTP Version Not Supported</li>
</ul>
</li>
</ul>
<h5 id="User-server-state-cookies"><a href="#User-server-state-cookies" class="headerlink" title="User-server state: cookies"></a>User-server state: cookies</h5><p>many Web sites use cookies four components:</p>
<ol>
<li>cookie header line of HTTP response message </li>
<li>cookie header line in next HTTP request message </li>
<li>cookie file kept on user ’s host, managed by user’s browser </li>
<li>back-end database at Web site</li>
</ol>
<p>example:</p>
<ul>
<li>Susan always access Internet from PC </li>
<li>visits specific e-commerce site for first time </li>
<li>when initial HTTP requests arrives at site, site creates: <ul>
<li>unique ID </li>
<li>entry in backend  database for ID</li>
</ul>
</li>
</ul>
<h6 id="Cookies-keeping-“-state-”"><a href="#Cookies-keeping-“-state-”" class="headerlink" title="Cookies: keeping “ state ”"></a>Cookies: keeping “ state ”</h6><img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326180056977.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326180056977.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220326180056977" style="zoom: 50%;">



<p>what cookies can be used  for: </p>
<ul>
<li>authorization </li>
<li>shopping carts </li>
<li>recommendations </li>
<li>user session state (Web e-mail)</li>
</ul>
<p>how to keep “ state ” : </p>
<ul>
<li>protocol endpoints: maintain state at sender&#x2F;receiver over multiple transactions </li>
<li>cookies: http messages carry state</li>
</ul>
<p>aside:</p>
<p>cookies and privacy:</p>
<ul>
<li>cookies permit sites to learn a lot about you </li>
<li>you may supply name and e-mail to sites</li>
</ul>
<h4 id="2-2-6-Web-caches-proxy-server"><a href="#2-2-6-Web-caches-proxy-server" class="headerlink" title="2.2.6 Web caches (proxy server)"></a>2.2.6 Web caches (proxy server)</h4><p>Goal: satisfy client request without involving origin server</p>
<ul>
<li>user sets browser: Web accesses via cache </li>
<li>browser sends all HTTP requests to cache <ul>
<li>object in cache: cache returns object </li>
<li>else cache requests object from origin server, then returns object to client</li>
</ul>
</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326180400483.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326180400483.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220326180400483" style="zoom:50%;">

<h5 id="More-about-Web-caching"><a href="#More-about-Web-caching" class="headerlink" title="More about Web caching:"></a>More about Web caching:</h5><ul>
<li><p>cache acts as both client and server </p>
<ul>
<li>server for original requesting client </li>
<li>client to origin server</li>
</ul>
</li>
<li><p>typically cache is installed by ISP (university, company, residential ISP)</p>
</li>
</ul>
<p>why Web caching?</p>
<ul>
<li>reduce response time for client request </li>
<li>reduce traffic on an institution’s access link </li>
<li>Internet dense with caches: enables “poor” content providers to effectively deliver content (so too does P2P file sharing)</li>
</ul>
<p>Caching example: </p>
<p>Method 1: Low access rate without cache</p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326181205889.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326181205889.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220326181205889" style="zoom:50%;">

<p>consequence:</p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326181234796.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326181234796.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220326181234796" style="zoom: 50%;">





<p>Method 2: High access rate without cache</p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326181323168.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326181323168.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220326181323168" style="zoom:50%;">

<p>consequence:</p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326181345960.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326181345960.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220326181345960" style="zoom:50%;">



<p>Method 3: Low access rate with cache</p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326181511953.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326181511953.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220326181511953" style="zoom:50%;">

<p>consequence:</p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326181528314.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326181528314.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220326181528314" style="zoom:50%;">



<h5 id="Conditional-GET"><a href="#Conditional-GET" class="headerlink" title="Conditional GET"></a>Conditional GET</h5><ul>
<li><p>Goal: don’t send object if cache has up-to-date cached version </p>
<ul>
<li>no object transmission  delay </li>
<li>lower link utilization</li>
</ul>
</li>
<li><p>cache: specify date of cached copy in HTTP request </p>
<ul>
<li>If-modified-since: date</li>
</ul>
</li>
<li><p>server: response contains no object if cached copy is not up-to-date:</p>
<p>HTTP&#x2F;1.0 304 Not Modified</p>
</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326181815633.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220326181815633.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220326181815633" style="zoom:50%;">



<h3 id="2-3-Electronic-mail"><a href="#2-3-Electronic-mail" class="headerlink" title="2.3 Electronic mail"></a>2.3 Electronic mail</h3><h4 id="2-3-1-preview"><a href="#2-3-1-preview" class="headerlink" title="2.3.1 preview"></a>2.3.1 preview</h4><ul>
<li><p>Three major components: </p>
<ul>
<li>user agents </li>
<li>mail servers </li>
<li>simple mail transfer protocol: SMTP</li>
</ul>
</li>
<li><p>User Agent </p>
<ul>
<li>a.k.a. “mail reader” </li>
<li>composing, editing, reading smail messages </li>
<li>e.g., Outlook, Thunderbird, iPhone mail client </li>
<li>outgoing, incoming messages stored on server</li>
</ul>
</li>
</ul>
<p><strong>Mail server</strong></p>
<ul>
<li>mailbox contains incoming messages for user </li>
<li>message queue of outgoing (to be sent) mail messages </li>
<li>SMTP protocol between mail servers to send email messages<ul>
<li>client: sending mail server </li>
<li>“server”: receiving mail server</li>
</ul>
</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327103254234.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327103254234.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220327103254234" style="zoom:50%;">



<h4 id="2-3-2-SMTP-RFC-2821"><a href="#2-3-2-SMTP-RFC-2821" class="headerlink" title="2.3.2 SMTP [RFC 2821]"></a>2.3.2 SMTP [RFC 2821]</h4><ul>
<li><p>uses TCP to reliably transfer email message from client to server, port 25 </p>
</li>
<li><p>direct transfer: sending server to receiving  server </p>
</li>
<li><p>three phases of transfer </p>
<ul>
<li>handshaking (greeting) </li>
<li>transfer of messages </li>
<li>closure</li>
</ul>
</li>
<li><p>command&#x2F;response interaction (like HTTP) </p>
<ul>
<li>commands: ASCII text </li>
<li>response: status code and phrase</li>
</ul>
</li>
<li><p>messages must be in 7-bit ASCI</p>
</li>
</ul>
<h5 id="Scenario-Alice-sends-message-to-Bob"><a href="#Scenario-Alice-sends-message-to-Bob" class="headerlink" title="Scenario: Alice sends message to Bob"></a>Scenario: Alice sends message to Bob</h5><ol>
<li>Alice uses UA to compose message “ to ” <a href="mailto:&#x62;&#x6f;&#x62;&#x40;&#115;&#x6f;&#109;&#x65;&#115;&#x63;&#104;&#111;&#111;&#108;&#x2e;&#x65;&#100;&#x75;">&#x62;&#x6f;&#x62;&#x40;&#115;&#x6f;&#109;&#x65;&#115;&#x63;&#104;&#111;&#111;&#108;&#x2e;&#x65;&#100;&#x75;</a> </li>
<li>Alice’s UA sends message to her mail server; message placed in message queue </li>
<li>client side of SMTP opens TCP connection with Bob’ s mail server </li>
<li>SMTP client sends Alice’ s message over the TCP connection </li>
<li>Bob’s mail server places the message in Bob’s mailbox </li>
<li>Bob invokes his user agent  to read message</li>
</ol>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327103711929.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327103711929.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220327103711929" style="zoom:50%;">

<h5 id="Final-words"><a href="#Final-words" class="headerlink" title="Final words"></a>Final words</h5><ul>
<li><strong>SMTP uses persistent connections</strong> </li>
<li>SMTP requires message (header &amp; body) to be in 7-bit ASCII </li>
<li>SMTP server uses CRLF.CRLF to determine end of message</li>
</ul>
<p><strong>comparison with HTTP:</strong></p>
<ul>
<li>HTTP: pull </li>
<li>SMTP: push </li>
<li>both have ASCII command&#x2F;response interaction, status codes </li>
<li>HTTP: each object encapsulated in its own response message </li>
<li>SMTP: multiple objects sent in multipart message</li>
</ul>
<h4 id="2-3-3-Mail-message-format"><a href="#2-3-3-Mail-message-format" class="headerlink" title="2.3.3 Mail message format"></a>2.3.3 Mail message format</h4><p>SMTP: protocol for exchanging email messages</p>
<p>RFC 822: standard for text  message format:</p>
<ul>
<li><p>header lines, e.g., </p>
<ul>
<li><p>To: </p>
</li>
<li><p>From: </p>
</li>
<li><p>Subject: </p>
<p>different from SMTP MAIL FROM, RCPT TO: commands!</p>
</li>
</ul>
</li>
<li><p>Body: the “ message ” </p>
<ul>
<li>ASCII characters only</li>
</ul>
</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327104353861.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327104353861.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220327104353861" style="zoom:50%;">

<h4 id="2-3-4-Mail-access-protocols"><a href="#2-3-4-Mail-access-protocols" class="headerlink" title="2.3.4 Mail access protocols"></a>2.3.4 Mail access protocols</h4><img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327104429481.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327104429481.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220327104429481" style="zoom:50%;">

<ul>
<li>SMTP: delivery&#x2F;storage to receiver’ s server</li>
<li>mail access protocol: retrieval from server<ul>
<li>POP: Post Office Protocol [RFC 1939]: authorization, download  </li>
<li>IMAP: Internet Mail Access Protocol [RFC 1730]: more features, including manipulation of stored messages on  server </li>
<li>HTTP: gmail, Hotmail, Yahoo! Mail, etc.</li>
</ul>
</li>
</ul>
<h4 id="2-3-5-POP3-protocol"><a href="#2-3-5-POP3-protocol" class="headerlink" title="2.3.5 POP3 protocol"></a>2.3.5 POP3 protocol</h4><img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327104621649.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327104621649.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220327104621649" style="zoom:50%;">



<h5 id="POP3-more-and-IMAP"><a href="#POP3-more-and-IMAP" class="headerlink" title="POP3 (more) and IMAP"></a>POP3 (more) and IMAP</h5><p>more about POP3 </p>
<ul>
<li>previous example uses POP3 “download and delete” mode </li>
<li>Bob cannot re-read e-mail if he changes client </li>
<li>POP3 “download-and-keep”: copies of messages on different clients </li>
<li>POP3 is stateless across sessions</li>
</ul>
<p>IMAP </p>
<ul>
<li>keeps all messages in one place: at server </li>
<li>allows user to organize messages in folders </li>
<li>keeps user state across sessions: <ul>
<li>names of folders and mappings between message IDs and folder name</li>
</ul>
</li>
</ul>
<h3 id="2-4-DNS"><a href="#2-4-DNS" class="headerlink" title="2.4 DNS"></a>2.4 DNS</h3><h4 id="2-4-1-preview"><a href="#2-4-1-preview" class="headerlink" title="2.4.1 preview"></a>2.4.1 preview</h4><p>people: many identifiers: </p>
<ul>
<li>SSN, name, passport</li>
</ul>
<p>Internet hosts, routers: </p>
<ul>
<li>IP address (32 bit) - used for addressing datagrams </li>
<li>“ name ” , e.g.,  <a target="_blank" rel="noopener" href="http://www.yahoo.com/">www.yahoo.com</a> - used by humans</li>
</ul>
<p>Question: how to map between IP address and name, and vice versa ?</p>
<p><strong>Domain Name System:</strong></p>
<ul>
<li>distributed database implemented in hierarchy of many name servers </li>
<li>application-layer protocol: hosts, name servers communicate to resolve names (address&#x2F;name  translation) <ul>
<li>note: core Internet function, implemented as applicationlayer protocol </li>
<li>complexity at network’ s “edge”</li>
</ul>
</li>
</ul>
<h4 id="2-4-2-services-structure"><a href="#2-4-2-services-structure" class="headerlink" title="2.4.2 services, structure"></a>2.4.2 services, structure</h4><p>DNS services </p>
<ul>
<li>hostname to IP address translation </li>
<li>host aliasing <ul>
<li>canonical, alias names</li>
</ul>
</li>
<li>mail server aliasing </li>
<li>load distribution <ul>
<li>replicated Web servers: many IP addresses correspond to one name</li>
</ul>
</li>
</ul>
<p>why not centralize DNS? </p>
<ul>
<li>single point of failure </li>
<li>traffic volume </li>
<li>distant centralized database </li>
<li>maintenance</li>
</ul>
<h4 id="2-4-3-hierarchical-database"><a href="#2-4-3-hierarchical-database" class="headerlink" title="2.4.3 hierarchical database"></a>2.4.3 hierarchical database</h4><img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327105738764.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327105738764.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220327105738764" style="zoom:50%;">

<p>client wants IP for <a target="_blank" rel="noopener" href="http://www.amazon.com/">www.amazon.com</a>; 1st approximation: </p>
<ul>
<li>client queries root server to find com DNS server </li>
<li>client queries .com DNS server to get amazon.com DNS server </li>
<li>client queries amazon.com DNS server to get IP address for <a target="_blank" rel="noopener" href="http://www.amazon.com/">www.amazon.com</a></li>
</ul>
<h5 id="root-name-servers"><a href="#root-name-servers" class="headerlink" title="root name servers"></a>root name servers</h5><ul>
<li>contacted by local name server that can not resolve name</li>
<li>root name server: <ul>
<li>contacts authoritative name server if name mapping not known </li>
<li>gets mapping </li>
<li>returns mapping to local name server</li>
</ul>
</li>
</ul>
<h5 id="TLD-and-authoritative-servers"><a href="#TLD-and-authoritative-servers" class="headerlink" title="TLD and authoritative servers"></a>TLD and authoritative servers</h5><p>top-level domain (TLD) servers: </p>
<ul>
<li>responsible for com, org, net, edu, aero, jobs, museums, and all top-level country domains, e.g.: uk, fr, ca, jp </li>
<li>Network Solutions maintains servers for .com TLD </li>
<li>Educate for .edu TLD</li>
</ul>
<p>authoritative DNS servers: </p>
<ul>
<li>organization’s own DNS server(s), providing authoritative hostname to IP mappings for organization’ s named hosts  </li>
<li>can be maintained by organization or service provider</li>
</ul>
<h5 id="Local-DNS-name-server"><a href="#Local-DNS-name-server" class="headerlink" title="Local DNS name server"></a>Local DNS name server</h5><ul>
<li>does not strictly belong to hierarchy </li>
<li>each ISP (residential ISP, company, university) has one <ul>
<li>also called “default name server”</li>
</ul>
</li>
<li>when host makes DNS query, query is sent to its  local DNS server <ul>
<li>has local cache of recent name-to-address translation pairs (but may be out of date!) </li>
<li>acts as proxy, forwards query into hierarchy</li>
</ul>
</li>
</ul>
<h5 id="DNS-name-resolution-example"><a href="#DNS-name-resolution-example" class="headerlink" title="DNS name  resolution example"></a>DNS name  resolution example</h5><p>host at cis.poly.edu  wants IP address for  gaia.cs.umass.edu</p>
<p>Type 1: iterated query</p>
<ul>
<li>contacted server replies with name of server to contact </li>
<li>“I don’t know this name, but ask this server ”</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327110905696.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327110905696.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220327110905696" style="zoom: 33%;">



<p>Type 2: recursive query</p>
<ul>
<li>puts burden of name resolution on contacted name server </li>
<li>heavy load at upper levels of hierarchy?</li>
</ul>
<h4 id="2-4-5-caching-updating-records"><a href="#2-4-5-caching-updating-records" class="headerlink" title="2.4.5 caching, updating records"></a>2.4.5 caching, updating records</h4><ul>
<li>once (any) name server learns mapping, it caches mapping<ul>
<li>cache entries timeout (disappear) after some time (TTL)</li>
<li>TLD servers typically cached in local name servers<ul>
<li><strong>thus root name servers not often visited</strong></li>
</ul>
</li>
</ul>
</li>
<li>cached entries may be out-of-date (best effort name-to-address translation!)<ul>
<li>if name host changes IP address, may not be known Internet-wide until all TTLs expire</li>
</ul>
</li>
<li>update&#x2F;notify mechanisms proposed IETF standard <ul>
<li>RFC 2136</li>
</ul>
</li>
</ul>
<h4 id="2-4-6-DNS-records"><a href="#2-4-6-DNS-records" class="headerlink" title="2.4.6 DNS records"></a>2.4.6 DNS records</h4><p>DNS: distributed database storing <u>resource records (RR)</u></p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327111423967.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327111423967.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220327111423967" style="zoom:50%;">

<p>type &#x3D; A </p>
<ul>
<li>name is hostname </li>
<li>value is IP address</li>
</ul>
<p>type &#x3D; NS</p>
<ul>
<li>name is domain (e.g.,  foo.com) </li>
<li>value is hostname of authoritative name server for this domain</li>
</ul>
<p>type &#x3D; CNAME</p>
<ul>
<li>name is alias name for some “canonical” (the real) name </li>
<li><a target="_blank" rel="noopener" href="http://www.ibm.com/">www.ibm.com</a> is really servereast.backup2.ibm.com </li>
<li>value is canonical name</li>
</ul>
<p>type &#x3D; MX</p>
<ul>
<li>value is name of mail server associated with name</li>
</ul>
<h4 id="2-4-7-protocol-messages"><a href="#2-4-7-protocol-messages" class="headerlink" title="2.4.7 protocol, messages"></a>2.4.7 protocol, messages</h4><ul>
<li>query and reply messages, both with same message  format</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327111823333.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327111823333.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220327111823333" style="zoom:50%;">

<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327111912135.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327111912135.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220327111912135" style="zoom:50%;">

<h4 id><a href="#" class="headerlink" title></a></h4><h4 id="2-4-8-Inserting-records-into-DNS"><a href="#2-4-8-Inserting-records-into-DNS" class="headerlink" title="2.4.8 Inserting records into DNS"></a>2.4.8 Inserting records into DNS</h4><ul>
<li><p>example: new startup “Network Utopia” </p>
</li>
<li><p>register name networkuptopia.com at DNS registrar (e.g., Network Solutions)</p>
<ul>
<li>provide names, IP addresses of authoritative name server (primary and secondary) </li>
<li>registrar inserts two RRs into .com TLD server: (networkutopia.com, dns1.networkutopia.com, NS) (dns1.networkutopia.com, 212.212.212.1, A)</li>
</ul>
</li>
<li><p>create authoritative server type A record for  <a target="_blank" rel="noopener" href="http://www.networkuptopia.com/">www.networkuptopia.com</a>; type MX record for  networkutopia.com</p>
</li>
</ul>
<h4 id="2-4-9-Attacking-DNS"><a href="#2-4-9-Attacking-DNS" class="headerlink" title="2.4.9 Attacking DNS"></a>2.4.9 Attacking DNS</h4><p>DDoS attacks</p>
<ul>
<li>bombard root servers with traffic <ul>
<li>not successful to date</li>
<li>traffic filtering </li>
<li>local DNS servers cache IPs of TLD servers, allowing root server bypass</li>
</ul>
</li>
<li>bombard TLD servers <ul>
<li>potentially more dangerous</li>
</ul>
</li>
</ul>
<p>redirect attacks</p>
<ul>
<li><p>man-in-middle </p>
<ul>
<li>Intercept queries</li>
</ul>
</li>
<li><p>DNS poisoning </p>
<ul>
<li>Send bogus relies to DNS server, which caches</li>
</ul>
</li>
</ul>
<p>exploit DNS for DDoS </p>
<ul>
<li>send queries with spoofed source address: target IP </li>
<li>requires amplification</li>
</ul>
<h3 id="2-5-P2P-applications"><a href="#2-5-P2P-applications" class="headerlink" title="2.5 P2P applications"></a>2.5 P2P applications</h3><h4 id="2-5-1-Pure-P2P-architecture"><a href="#2-5-1-Pure-P2P-architecture" class="headerlink" title="2.5.1 Pure P2P architecture"></a>2.5.1 Pure P2P architecture</h4><ul>
<li>no always-on server </li>
<li>arbitrary end systems directly communicate </li>
<li>peers are intermittently connected and change IP addresses</li>
</ul>
<p>examples:</p>
<ul>
<li>file distribution (Bit Torrent) </li>
<li>Streaming (KanKan) </li>
<li>sVoIP (Skype)</li>
</ul>
<h4 id="2-5-2-File-distribution-client-server-vs-P2P"><a href="#2-5-2-File-distribution-client-server-vs-P2P" class="headerlink" title="2.5.2 File distribution: client-server vs P2P"></a>2.5.2 File distribution: client-server vs P2P</h4><p><strong><u>Question: how much time to distribute file (size F) from one server to N peers?</u></strong></p>
<ul>
<li>peer upload&#x2F;download capacity is limited resource</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327112951097.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327112951097.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220327112951097" style="zoom:50%;">



<h5 id="File-distribution-time-client-server"><a href="#File-distribution-time-client-server" class="headerlink" title="File distribution time: client-server"></a>File distribution time: client-server</h5><ul>
<li><p>server transmission: must sequentially send (upload) N  file copies: </p>
<ul>
<li>time to send one copy: F&#x2F;us </li>
<li>time to send N copies: NF&#x2F;us</li>
</ul>
</li>
<li><p>client: each client must download file copy </p>
<ul>
<li>dmin &#x3D; min client download rate </li>
<li>min client download time: F&#x2F;dmin</li>
</ul>
</li>
<li><p>Time to distribute F to N clients using client-server approach:</p>
</li>
</ul>
<p>$$<br>D_{c-s} \ge max(\frac{NF}{u_s},\frac{F}{d_{min}})<br>$$</p>
<p><strong>The coefficient of the NF increases linearly in N</strong></p>
<h5 id="File-distribution-time-P2P"><a href="#File-distribution-time-P2P" class="headerlink" title="File distribution time: P2P"></a>File distribution time: P2P</h5><ul>
<li><p>server transmission: must upload at least one copy</p>
<ul>
<li>time to send one copy: F&#x2F;u</li>
</ul>
</li>
<li><p>client: each client must download file copy </p>
<ul>
<li>min client download time: F&#x2F;dmin</li>
</ul>
</li>
<li><p>clients: as aggregate must download NF bits</p>
<ul>
<li>max upload rate (limiting max download rate) is us + Sui</li>
</ul>
</li>
<li><p>time to distribute F to N clients using P2P approach<br>$$<br>D_{P2P} \ge max(\frac{F}{u_s},\frac{F}{d_{min}},\frac{NF}{u_s + \sum{u_i}})<br>$$</p>
</li>
</ul>
<p><strong>The coefficient of the NF increases linearly also in N, but so does, as each peer brings service capacity</strong></p>
<p> Comparison:</p>
<p>Hypothesize: client upload rate &#x3D; u, F&#x2F;u &#x3D; 1 hour, us &#x3D; 10u, dmin ≥ us</p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327114828901.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327114828901.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220327114828901" style="zoom:50%;">

<h4 id="2-5-3-BitTorrent"><a href="#2-5-3-BitTorrent" class="headerlink" title="2.5.3  BitTorrent"></a>2.5.3  BitTorrent</h4><ul>
<li>file divided into 256Kb chunks </li>
<li>peers in torrent send&#x2F;receive file chunks</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327114927703.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327114927703.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220327114927703" style="zoom: 33%;">



<ul>
<li><p>peer joining torrent: </p>
<ul>
<li>has no chunks, but will accumulate them over time from other peers </li>
<li>registers with tracker to get list of peers, connects to subset of peers (“neighbors”)</li>
</ul>
</li>
<li><p>while downloading, peer uploads chunks to other peers </p>
</li>
<li><p>peer may change peers with whom it exchanges chunks </p>
</li>
<li><p>churn: peers may come and go </p>
</li>
<li><p>once peer has entire file, it may (selfishly) leave or (altruistically) remain in torrent</p>
</li>
</ul>
<h5 id="requesting-sending-file-chunks"><a href="#requesting-sending-file-chunks" class="headerlink" title="requesting, sending file chunks"></a>requesting, sending file chunks</h5><p>requesting chunks:</p>
<ul>
<li>at any given time, different peers have different subsets of file chunks </li>
<li>periodically, Alice asks each peer for list of chunks that they have </li>
<li>Alice requests missing chunks from peers, rarest first</li>
</ul>
<p>sending chunks: tit-for-tat</p>
<ul>
<li>Alice sends chunks to those four peers currently sending her chunks at highest rate<ul>
<li>other peers are choked by Alice (do not receive chunks from her) </li>
<li>re-evaluate top 4 every 10 secs</li>
</ul>
</li>
<li>every 30 secs: randomly select another peer, starts sending  chunks </li>
<li>“optimistically unchoke” this peer </li>
<li>newly chosen peer may join top 4</li>
</ul>
<h5 id="tit-for-tat"><a href="#tit-for-tat" class="headerlink" title="tit-for-tat"></a>tit-for-tat</h5><ol>
<li>Alice “optimistically unchokes” Bob </li>
<li>Alice becomes one of Bob’ s top-four providers; Bob reciprocates </li>
<li>Bob becomes one of Alice’ s top-four providers</li>
</ol>
<h3 id="2-6-video-streaming-and-content-delivery-networks-CDNs"><a href="#2-6-video-streaming-and-content-delivery-networks-CDNs" class="headerlink" title="2.6 video streaming and content delivery networks (CDNs)"></a>2.6 video streaming and content delivery networks (CDNs)</h3><h4 id="2-6-1-Video-Streaming-and-CDNs-context"><a href="#2-6-1-Video-Streaming-and-CDNs-context" class="headerlink" title="2.6.1 Video Streaming and CDNs: context"></a>2.6.1 Video Streaming and CDNs: context</h4><ul>
<li>video traffic: major consumer of Internet bandwidth <ul>
<li>Netflix, YouTube: 37%, 16% of downstream residential ISP traffic</li>
<li>~1B YouTube users, ~75M Netflix users</li>
</ul>
</li>
<li>challenge: scale - how to reach ~1B  users? <ul>
<li>single mega-video server won’t work (why?)</li>
</ul>
</li>
<li>challenge: </li>
<li>heterogeneity <ul>
<li>different users have different capabilities (e.g.,  wired versus mobile; bandwidth rich versus  bandwidth poor)</li>
</ul>
</li>
<li>solution: distributed, application-level  infrastructure</li>
</ul>
<h4 id="2-6-2-Multimedia-video"><a href="#2-6-2-Multimedia-video" class="headerlink" title="2.6.2 Multimedia: video"></a>2.6.2 Multimedia: video</h4><ul>
<li><p>video: sequence of images displayed at constant rate </p>
<ul>
<li>e.g., 24 images&#x2F;sec</li>
</ul>
</li>
<li><p>digital image: array of pixels </p>
<ul>
<li>each pixel represented  by bits</li>
</ul>
</li>
<li><p>coding: use redundancy within and between images to decrease # bits used to encode image </p>
<ul>
<li>spatial (within image) </li>
<li>temporal (from one image to next)</li>
</ul>
</li>
</ul>
<p>CBR: (constant bit rate):  video encoding rate fixed</p>
<p>VBR: (variable bit rate):  video encoding rate changes as amount of spatial, temporal coding changes </p>
<p>examples: </p>
<ul>
<li>MPEG1 (CD-ROM) 1.5  Mbps </li>
<li>MPEG2 (DVD) 3-6 Mbps </li>
<li>MPEG4 (often used in  Internet, &lt; 1 Mbps)</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327134304886.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327134304886.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220327134304886" style="zoom: 50%;">



<h4 id="2-6-3-Streaming-multimedia-DASH"><a href="#2-6-3-Streaming-multimedia-DASH" class="headerlink" title="2.6.3 Streaming multimedia: DASH"></a>2.6.3 Streaming multimedia: DASH</h4><ul>
<li><p>DASH: Dynamic, Adaptive Streaming over HTTPs</p>
</li>
<li><p>server: </p>
<ul>
<li>divides video file into multiple chunks </li>
<li>each chunk stored, encoded at different rates  </li>
<li>manifest file: provides URLs for different chunks</li>
</ul>
</li>
<li><p>client: </p>
<ul>
<li>periodically measures server-to-client bandwidth </li>
<li>consulting manifest, requests one chunk at a time  </li>
<li>chooses maximum coding rate sustainable given current bandwidth </li>
<li>can choose different coding rates at different points in time (depending on available bandwidth at time)</li>
</ul>
</li>
<li><p>“intelligence” at client: client determines </p>
<ul>
<li>when to request chunk (so that buffer starvation, or overflow does not occur) </li>
<li>what encoding rate to request (higher quality when more bandwidth available) </li>
<li>where to request chunk (can request from URL server that is “close” to client or has high available bandwidth)</li>
</ul>
</li>
</ul>
<h4 id="2-6-4-Content-distribution-networks-CDNs"><a href="#2-6-4-Content-distribution-networks-CDNs" class="headerlink" title="2.6.4 Content distribution networks(CDNs)"></a>2.6.4 Content distribution networks(CDNs)</h4><ul>
<li><p>challenge: how to stream content (selected from millions of videos) to hundreds of thousands of simultaneous users?</p>
</li>
<li><p>option 1: single, large “mega-server”</p>
<ul>
<li>single point of failure </li>
<li>point of network congestion </li>
<li>long path to distant clients </li>
<li>multiple copies of video sent over outgoing link</li>
</ul>
</li>
<li><p>option 2: store&#x2F;serve multiple copies of videos at multiple geographically distributed sites (CDN)</p>
<ul>
<li>enter deep: push CDN servers deep into many access  networks <ul>
<li>close to users </li>
<li>used by Akamai, 1700 locations</li>
</ul>
</li>
<li>bring home: smaller number (10’s) of larger clusters in POPs near (but not within) access networks<ul>
<li>used by Limelight</li>
</ul>
</li>
</ul>
</li>
<li><p>CDN: stores copies of content at CDN nodes </p>
<ul>
<li>e.g. Netflix stores copies of MadMen</li>
</ul>
</li>
<li><p>subscriber requests content from CDN:</p>
<ul>
<li>directed to nearby copy, retrieves content </li>
<li>may choose different copy if network path congested</li>
</ul>
</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327135820577.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327135820577.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220327135820577" style="zoom:50%;">

<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327135927172.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327135927172.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220327135927172" style="zoom:50%;">



<ul>
<li>OTT challenges: coping with a congested Internet<ul>
<li>from which CDN node to retrieve content?</li>
<li>viewer behavior in presence of congestion? </li>
<li>what content to place in which CDN node?</li>
</ul>
</li>
</ul>
<h5 id="closer-look"><a href="#closer-look" class="headerlink" title="closer look"></a>closer look</h5><img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327140133656.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327140133656.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220327140133656" style="zoom:50%;">



<p>case: Netflix</p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327140216236.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327140216236.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220327140216236" style="zoom:50%;">



<h3 id="2-7-socket-programming-with-UDP-and-TCP"><a href="#2-7-socket-programming-with-UDP-and-TCP" class="headerlink" title="2.7 socket programming  with UDP and TCP"></a>2.7 socket programming  with UDP and TCP</h3><h4 id="2-7-1-Socket-programming"><a href="#2-7-1-Socket-programming" class="headerlink" title="2.7.1 Socket programming"></a>2.7.1 Socket programming</h4><p>goal: learn how to build client&#x2F;server applications that communicate using sockets、</p>
<p>socket: door between application process and end-end-transport protocol</p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327140604126.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327140604126.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220327140604126" style="zoom:50%;">



<p>Two socket types for two transport services: </p>
<ul>
<li>UDP: unreliable datagram </li>
<li>TCP: reliable, byte stream-oriented</li>
</ul>
<p>Application Example:</p>
<ol>
<li>client reads a line of characters (data) from its keyboard and sends data to server </li>
<li>server receives the data and converts characters to uppercase </li>
<li>server sends modified data to client </li>
<li>client receives modified data and displays line on its screen</li>
</ol>
<h4 id="2-7-2-UDP"><a href="#2-7-2-UDP" class="headerlink" title="2.7.2  UDP"></a>2.7.2  UDP</h4><p>UDP: no “connection” between client &amp; server</p>
<ul>
<li>no handshaking before sending data </li>
<li>sender explicitly attaches IP destination address and port # to each packet </li>
<li>receiver extracts sender IP address and port# from received packet</li>
</ul>
<p>UDP: transmitted data may be lost or received out-of-order</p>
<p>Application viewpoint:</p>
<ul>
<li>UDP provides unreliable transfer of groups of bytes (“datagrams”) between client and server</li>
</ul>
<p>Client&#x2F;server socket interaction: UDP</p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327141318253.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327141318253.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220327141318253" style="zoom: 50%;">



<p>Example app: UDP client</p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327141437609.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327141437609.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220327141437609" style="zoom: 33%;">

<p>Example app: UDP server</p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327141551327.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327141551327.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220327141551327" style="zoom: 33%;">

<h4 id="-1"><a href="#-1" class="headerlink" title></a></h4><h4 id="2-7-3-TCP"><a href="#2-7-3-TCP" class="headerlink" title="2.7.3  TCP"></a>2.7.3  TCP</h4><ul>
<li><p>client must contact server </p>
<ul>
<li><p>server process must first be running </p>
</li>
<li><p>server must have created socket (door) that welcomes client’s contact</p>
</li>
</ul>
</li>
<li><p>client contacts server by:</p>
<ul>
<li>Creating TCP socket, specifying IP address, port number of server process </li>
<li>when client creates socket: client TCP establishes connection to server TCP</li>
<li>when contacted by client, server TCP creates new socket for server process to communicate with that particular client <ul>
<li>allows server to talk with multiple clients </li>
<li>source port numbers used to distinguish clients (more in Chap 3)</li>
</ul>
</li>
</ul>
</li>
<li><p>application viewpoint:</p>
<ul>
<li>TCP provides reliable, in-order byte-stream transfer (“pipe”)  between client and server</li>
</ul>
</li>
</ul>
<p>Client&#x2F;server socket interaction: TCP</p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327142056192.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327142056192.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220327142056192" style="zoom: 50%;">



<p>Example app: TCP client</p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327142231464.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327142231464.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220327142231464" style="zoom: 33%;">



<p>Example app: TCP server</p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327142258946.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220327142258946.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220327142258946" style="zoom: 33%;">



<h2 id="Homework2-supplements-extension-and-correct"><a href="#Homework2-supplements-extension-and-correct" class="headerlink" title="Homework2 supplements (extension and correct)"></a>Homework2 supplements (extension and correct)</h2><ul>
<li>DNS use UDP to transfer data</li>
<li>The default mode of HTTP uses persistent connection with pipelining</li>
<li>If the header line Connection is close, it means that the client wants non-persistent connection</li>
<li></li>
</ul>
<h2 id="3-chapter3-Transport-layer"><a href="#3-chapter3-Transport-layer" class="headerlink" title="3. chapter3 Transport layer"></a>3. chapter3 Transport layer</h2><h3 id="prevew"><a href="#prevew" class="headerlink" title="prevew:"></a>prevew:</h3><ul>
<li>understand principles behind transport layer services:<ul>
<li>multiplexing, demultiplexing </li>
<li>reliable data transfer </li>
<li>flow control </li>
<li>congestion control</li>
</ul>
</li>
<li>learn about Internet transport layer protocols: <ul>
<li>UDP: connectionless transport </li>
<li>TCP: connection-oriented  reliable transport </li>
<li>TCP congestion control</li>
</ul>
</li>
</ul>
<h3 id="3-1-transport-layer-service"><a href="#3-1-transport-layer-service" class="headerlink" title="3.1 transport-layer service"></a>3.1 transport-layer service</h3><h4 id="3-1-1-Transport-services-and-protocols"><a href="#3-1-1-Transport-services-and-protocols" class="headerlink" title="3.1.1 Transport services and protocols"></a>3.1.1 Transport services and protocols</h4><ul>
<li>provide logical communication between app processes running on different hosts</li>
<li>transport protocols run in end systems <ul>
<li>send side: breaks app messages into segments, passes to network layer </li>
<li>rcv side: reassembles segments into messages, passes to app layer</li>
</ul>
</li>
</ul>
<h4 id="3-1-2-Transport-vs-network-layer"><a href="#3-1-2-Transport-vs-network-layer" class="headerlink" title="3.1.2 Transport vs. network layer"></a>3.1.2 Transport vs. network layer</h4><ul>
<li>network layer: logical  communication  between hosts</li>
<li>transport layer: logical communication between processes <ul>
<li>relies on, enhances,  network layer  services</li>
</ul>
</li>
</ul>
<h4 id="3-1-3-Internet-transport-layer-protocols"><a href="#3-1-3-Internet-transport-layer-protocols" class="headerlink" title="3.1.3 Internet transport-layer protocols"></a>3.1.3 Internet transport-layer protocols</h4><ul>
<li><p>reliable, in-order  delivery (TCP)</p>
<ul>
<li>congestion control </li>
<li>flow control</li>
<li>connection setup</li>
</ul>
</li>
<li><p>unreliable, unordered  delivery: UDP </p>
<ul>
<li>no-frills extension of “best-effort” IP</li>
</ul>
</li>
<li><p>services not available:</p>
<ul>
<li>delay guarantees</li>
<li>bandwidth guarantees</li>
</ul>
</li>
</ul>
<h3 id="3-2-multiplexing-and-demultiplexing"><a href="#3-2-multiplexing-and-demultiplexing" class="headerlink" title="3.2 multiplexing and demultiplexing"></a>3.2 multiplexing and demultiplexing</h3><h4 id="3-2-1-Multiplexing-x2F-demultiplexing"><a href="#3-2-1-Multiplexing-x2F-demultiplexing" class="headerlink" title="3.2.1 Multiplexing&#x2F;demultiplexing"></a>3.2.1 Multiplexing&#x2F;demultiplexing</h4><ul>
<li><p>multiplexing at sender:</p>
<p>handle data from multiple sockets, add transport header  (later used for demultiplexing)</p>
</li>
<li><p>demultiplexing at receiver:</p>
<p>use header info to deliver received segments to correct  socket</p>
</li>
</ul>
<h4 id="3-2-2-How-demultiplexing-works"><a href="#3-2-2-How-demultiplexing-works" class="headerlink" title="3.2.2 How demultiplexing works"></a>3.2.2 How demultiplexing works</h4><ul>
<li><p>host receives IP datagrams</p>
<ul>
<li>each datagram has source IP address, destination IP address</li>
<li>each datagram carries one transport-layer segment</li>
<li>each segment has source, destination port number</li>
</ul>
</li>
<li><p>host uses IP addresses &amp; port numbers to direct segment to appropriate socket</p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220413205144831.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220413205144831.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220413205144831" style="zoom:50%;"></li>
</ul>
<h4 id="3-2-3-Connectionless-demultiplexing"><a href="#3-2-3-Connectionless-demultiplexing" class="headerlink" title="3.2.3 Connectionless demultiplexing"></a>3.2.3 Connectionless demultiplexing</h4><ul>
<li><p>recall: created socket has host-local port #: </p>
<p>DatagramSocket mySocket1  &#x3D; new DatagramSocket(12534);</p>
</li>
<li><p>recall: when creating datagram to send into UDP socket, must specify </p>
<ul>
<li>destination IP address </li>
<li>destination port #</li>
</ul>
</li>
<li><p>when host receives UDP  segment:</p>
<ul>
<li>checks destination port #  in segment</li>
<li>directs UDP segment to  socket with that port # IP datagrams with same dest. port #</li>
</ul>
</li>
</ul>
<p>example：</p>
<h4 id="3-2-4-Connection-oriented-demux"><a href="#3-2-4-Connection-oriented-demux" class="headerlink" title="3.2.4 Connection-oriented demux"></a>3.2.4 Connection-oriented demux</h4><ul>
<li><p>TCP socket identified by 4-tuple: </p>
<ul>
<li>source IP address</li>
<li>source port number </li>
<li>dest IP address</li>
<li>dest port number</li>
</ul>
</li>
<li><p>demux: receiver uses all four values to direct segment to appropriate socket</p>
</li>
<li><p>server host may support  many simultaneous TCP  sockets: </p>
<ul>
<li>each socket identified by its own 4-tuple</li>
</ul>
</li>
<li><p>web servers have different sockets for each connecting client</p>
<ul>
<li>non-persistent HTTP will have different socket for each request</li>
</ul>
</li>
</ul>
<p>example：</p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220413205909578.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220413205909578.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220413205909578" style="zoom: 50%;">





<h3 id="3-3-connectionless-transport-UDP"><a href="#3-3-connectionless-transport-UDP" class="headerlink" title="3.3 connectionless transport: UDP"></a>3.3 connectionless transport: UDP</h3><h4 id="3-3-1-UDP-User-Datagram-Protocol"><a href="#3-3-1-UDP-User-Datagram-Protocol" class="headerlink" title="3.3.1 UDP: User Datagram Protocol"></a>3.3.1 UDP: User Datagram Protocol</h4><ul>
<li><p>“no frills,” “bare bones” Internet transport  protocol</p>
</li>
<li><p>“best effort” service, UDP  segments may be:</p>
<ul>
<li>lost</li>
<li>delivered out-of-order to app</li>
</ul>
</li>
<li><p><strong>connectionless</strong>:</p>
<ul>
<li>no handshaking between UDP sender, receiver</li>
<li>each UDP segment handled independently of others</li>
</ul>
</li>
<li><p>UDP use: </p>
<ul>
<li>streaming multimedia apps (loss tolerant, rate sensitive) </li>
<li>DNS</li>
<li>SNMP</li>
</ul>
</li>
<li><p>reliable transfer over UDP:</p>
<ul>
<li>add reliability at application layer</li>
<li>application-specific error recovery!</li>
</ul>
</li>
</ul>
<h4 id="3-3-2-UDP-segment-header"><a href="#3-3-2-UDP-segment-header" class="headerlink" title="3.3.2 UDP: segment header"></a>3.3.2 UDP: segment header</h4><img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220413210352750.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220413210352750.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220413210352750" style="zoom:50%;">



<ul>
<li>why is there a UDP?<ul>
<li>no connection establishment (which can add delay)</li>
<li>simple: no connection state at sender, receiver</li>
<li>small header size</li>
<li>no congestion control: UDP can blast away as fast as desired</li>
</ul>
</li>
</ul>
<h4 id="3-3-3-UDP-checksum"><a href="#3-3-3-UDP-checksum" class="headerlink" title="3.3.3 UDP checksum"></a>3.3.3 UDP checksum</h4><p>Goal: detect “ errors ” (e.g., flipped bits) in transmitted segment.</p>
<ul>
<li>sender:<ul>
<li>treat segment contents, including header fields, as sequence of 16-bit integers</li>
<li>checksum: addition (one’s complement sum) of segment contents</li>
<li>sender puts checksum value into UDP checksum field</li>
</ul>
</li>
<li>receiver:<ul>
<li>compute checksum of received segment </li>
<li>check if computed checksum equals checksum field value: </li>
<li>NO - error detected </li>
<li>YES - no error detected.  But maybe errors  nonetheless? More later</li>
</ul>
</li>
</ul>
<h5 id="Internet-checksum-example"><a href="#Internet-checksum-example" class="headerlink" title="Internet checksum: example"></a>Internet checksum: example</h5><p>example: add two 16-bit integers：</p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220413210745184.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220413210745184.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220413210744966" style="zoom:50%;">



<p><strong>Note: when adding numbers, a carryout from the most  significant bit needs to be added to the result</strong></p>
<h3 id="3-4-principles-of-reliable-data-transfer"><a href="#3-4-principles-of-reliable-data-transfer" class="headerlink" title="3.4 principles of reliable data transfer"></a>3.4 principles of reliable data transfer</h3><h4 id="3-4-1-reliable-data-transfer"><a href="#3-4-1-reliable-data-transfer" class="headerlink" title="3.4.1 reliable data transfer"></a>3.4.1 reliable data transfer</h4><img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220413211157155.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220413211157155.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220413211157155" style="zoom:50%;">



<ul>
<li>important in application, transport, link layers<ul>
<li>top-10 list of important networking topics</li>
</ul>
</li>
<li>characteristics of unreliable channel will determine  complexity of reliable data transfer protocol (rdt)</li>
</ul>
<h4 id="3-4-2-getting-started"><a href="#3-4-2-getting-started" class="headerlink" title="3.4.2 getting started"></a>3.4.2 getting started</h4><img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220413211303235.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220413211303235.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220413211303235" style="zoom: 50%;">



<p>we will:</p>
<ul>
<li>incrementally develop sender, receiver sides of reliable data transfer protocol (rdt)</li>
<li>consider only unidirectional data transfer<ul>
<li>but control info will flow on both directions!</li>
<li>use finite state machines (FSM) to specify sender, receiver</li>
</ul>
</li>
</ul>
<h4 id="3-4-3-rdt1-0"><a href="#3-4-3-rdt1-0" class="headerlink" title="3.4.3 rdt1.0"></a>3.4.3 rdt1.0</h4><p>rdt1.0: reliable transfer over a reliable channel</p>
<ul>
<li><p>underlying channel perfectly reliable </p>
<ul>
<li>no bit errors </li>
<li>no loss of packets</li>
</ul>
</li>
<li><p>separate FSMs for sender, receiver:</p>
<ul>
<li>sender sends data into underlying channel </li>
<li>receiver reads data from underlying channel</li>
</ul>
</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220413211816243.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220413211816243.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220413211816243" style="zoom:50%;">



<h4 id="3-4-4-rdt2-0"><a href="#3-4-4-rdt2-0" class="headerlink" title="3.4.4 rdt2.0"></a>3.4.4 rdt2.0</h4><p>rdt2.0: channel with bit errors</p>
<ul>
<li><p>underlying channel may flip bits in packet</p>
<ul>
<li>checksum to detect bit errors</li>
</ul>
</li>
<li><p>the question: how to recover from errors:</p>
<ul>
<li>acknowledgements (ACKs): receiver explicitly tells sender that pkt received OK</li>
<li>negative acknowledgements (NAKs): receiver explicitly tells sender that pkt had errors</li>
<li>sender retransmits pkt on receipt of NAK</li>
</ul>
</li>
<li><p>new mechanisms in rdt2.0 (beyond rdt1.0):</p>
<ul>
<li>error detection</li>
<li>feedback: control msgs (ACK,NAK) from receiver to sender</li>
</ul>
</li>
</ul>
<h5 id="FSM-specification"><a href="#FSM-specification" class="headerlink" title="FSM specification"></a>FSM specification</h5><p>sender:</p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220413212225692.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220413212225692.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220413212225692" style="zoom:50%;">



<p>receiver:</p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220413212245813.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220413212245813.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220413212245813" style="zoom:50%;">

<h5 id="A-fatal-flaw"><a href="#A-fatal-flaw" class="headerlink" title="A fatal flaw"></a>A fatal flaw</h5><p>what happens if ACK&#x2F;NAK corrupted?</p>
<ul>
<li>sender doesn’t know what happened at receiver!</li>
<li>can ’t just retransmit: possible duplicate</li>
</ul>
<p>handling duplicates:</p>
<ul>
<li>sender retransmits current pkt if ACK&#x2F;NAK corrupted</li>
<li>sender adds sequence number to each pkt </li>
<li>receiver discards (doesn’t deliver up) duplicate pkt</li>
</ul>
<p>stop and wait:</p>
<ul>
<li>sender sends one packet, then waits for receiver response</li>
</ul>
<h4 id="3-4-5-rdt2-1"><a href="#3-4-5-rdt2-1" class="headerlink" title="3.4.5 rdt2.1"></a>3.4.5 rdt2.1</h4><ul>
<li>sender, handles garbled ACK&#x2F;NAKs</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220413212721018.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220413212721018.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220413212721018" style="zoom:50%;">

<ul>
<li>receiver, handles garbled ACK&#x2F;NAKs</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220413212909502.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220413212909502.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220413212909502" style="zoom:50%;">



<h5 id="discussion"><a href="#discussion" class="headerlink" title="discussion"></a>discussion</h5><ul>
<li>sender:<ul>
<li>sequence number added to pkt</li>
<li>two sequence number(0,1) will suffice. Why?</li>
<li>must check if received ACK&#x2F;NAK corrupted</li>
<li>twice as many states<ul>
<li>state must “remember” whether “expected” pkt should have sequence number of 0 or 1</li>
</ul>
</li>
</ul>
</li>
<li>receiver:<ul>
<li>must check if received packet is duplicate</li>
<li>state indicates whether 0 or 1 is expected pkt sequence number</li>
</ul>
</li>
<li>note: receiver can not know if its last ACK&#x2F;NAK received OK at sender</li>
</ul>
<h4 id="3-4-6-rdt2-2"><a href="#3-4-6-rdt2-2" class="headerlink" title="3.4.6 rdt2.2"></a>3.4.6 rdt2.2</h4><p>rdt2.2: a NAK-free protocol</p>
<ul>
<li>same functionality as rdt2.1, using ACKs only</li>
<li>instead of NAK, receiver sends ACK for last pkt received OK</li>
<li>receiver must explicitly include sequence number of pkt being ACKed</li>
<li>duplicate ACK at sender results in same action as NAK: retransmit current pkt</li>
</ul>
<p>sender, receiver fragments:</p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220413213639475.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220413213639475.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220413213639475" style="zoom: 50%;">



<h4 id="3-4-7-rdt3-0"><a href="#3-4-7-rdt3-0" class="headerlink" title="3.4.7 rdt3.0"></a>3.4.7 rdt3.0</h4><p>new assumption:</p>
<ul>
<li>underlying channel can also lose packets (data, ACKs)<ul>
<li>checksum, sequence number, ACKs, retransmissions  will be of help … but not enough</li>
</ul>
</li>
</ul>
<p>approach:</p>
<ul>
<li>sender waits “reasonable” amount of time for ACK<ul>
<li>retransmits if no ACK  received in this time</li>
<li>if pkt (or ACK) just delayed (not lost):<ul>
<li>retransmission will be duplicate, but sequence number has already handles this</li>
<li>receiver must specify sequence number of pkt being ACKed</li>
</ul>
</li>
<li>requires countdown timer</li>
</ul>
</li>
</ul>
<p>sender:</p>
<p><u><strong>timer was set up at the same time  when the packet was sent.</strong></u></p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220413214103878.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220413214103878.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220413214103878" style="zoom:50%;">



<h5 id="action"><a href="#action" class="headerlink" title="action"></a>action</h5><img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220413214447682.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220413214447682.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220413214447682" style="zoom:50%;">

<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220413214509954.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220413214509954.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220413214509954" style="zoom:50%;">



<h5 id="Performance"><a href="#Performance" class="headerlink" title="Performance"></a>Performance</h5><ul>
<li><p>rdt3.0 is correct, but performance stinks</p>
</li>
<li><p>example: 1 Gbps link, 15 ms prop. delay, 8000 bit packet:</p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220413215044881.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220413215044881.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220413215044881" style="zoom:50%;">

<ul>
<li>U sender: utilization – fraction of time sender busy sending</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220413215224086.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220413215224086.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220413215224086" style="zoom:50%;">

<ul>
<li>if RTT&#x3D;30 msec, 1KB pkt every 30 msec: 33kB&#x2F;sec thruput  over 1 Gbps link</li>
</ul>
</li>
<li><p>network protocol limits use of physical resources!</p>
</li>
</ul>
<h5 id="stop-and-wait-operation"><a href="#stop-and-wait-operation" class="headerlink" title="stop-and-wait operation"></a>stop-and-wait operation</h5><img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220413215341953.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220413215341953.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220413215341953" style="zoom:50%;">







<h4 id="3-4-8-Pipelined-protocols"><a href="#3-4-8-Pipelined-protocols" class="headerlink" title="3.4.8 Pipelined protocols"></a>3.4.8 Pipelined protocols</h4><p>pipelining: sender allows multiple, “in-flight”, yet-to-be-acknowledged pkt</p>
<ul>
<li>range of sequence numbers must be increased</li>
<li>buffering at sender and&#x2F;or receiver</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220413215628683.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220413215628683.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220413215628683" style="zoom:50%;">

<ul>
<li>two generic forms of pipelined protocols: go-Back-N, selective repeat</li>
</ul>
<h5 id="increased-utilization"><a href="#increased-utilization" class="headerlink" title="increased utilization"></a>increased utilization</h5><img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220413215715205.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220413215715205.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220413215715205" style="zoom:50%;">



<h5 id="overview"><a href="#overview" class="headerlink" title="overview:"></a>overview:</h5><p>Go-back-N:</p>
<ul>
<li>sender can have up to N unacked packets in pipeline</li>
<li>receiver only sends cumulative ack<ul>
<li>doesn’t ack packet if  there’ s a gap</li>
</ul>
</li>
<li>sender has timer for oldest unacked packet<ul>
<li>when timer expires, retransmit all unacked packets</li>
</ul>
</li>
</ul>
<p>Selective Repeat:</p>
<ul>
<li>sender can have up to N unack’ed packets in pipeline</li>
<li>receiver sends individual ack for each packet</li>
<li>sender maintains timer for each unacked packet<ul>
<li>when timer expires,  retransmit only that unacked packet</li>
</ul>
</li>
</ul>
<h5 id="Go-Back-N"><a href="#Go-Back-N" class="headerlink" title="Go-Back-N:"></a>Go-Back-N:</h5><p>sender:</p>
<ul>
<li>k-bit sequence number in pkt header</li>
<li>“window” of up to N, consecutive unack’ed pkts allowed</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220416150337516.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220416150337516.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220416150337516" style="zoom:50%;">

<ul>
<li>ACK(n): ACKs all pkts up to, including seq # n - “cumulative  ACK”<ul>
<li>may receive duplicate ACKs (see receiver)</li>
</ul>
</li>
<li><strong>timer for oldest in-flight pkt</strong></li>
<li>timeout(n): retransmit packet n and all higher seq # pkts in window</li>
</ul>
<p>sender extended FSM:</p>
<p>The timer was set at the same time the oldest packet was sent</p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220416150606898.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220416150606898.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220416150606898" style="zoom:50%;">

<p>receiver extended FSM: </p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220416151306662.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220416151306662.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220416151306662" style="zoom:50%;">

<p>ACK-only: always send ACK for correctly-received packet with highest in-order sequence</p>
<ul>
<li>may generate duplicate ACKs</li>
<li>need only remember expectedseqnum</li>
</ul>
<p> out-of-order pkt: </p>
<ul>
<li>discard (don’t buffer): no receiver buffering!</li>
<li>re-ACK pkt with highest in-order seq #</li>
</ul>
<p>GBN in action:</p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220416151601258.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220416151601258.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220416151601258" style="zoom:50%;">



<h5 id="Selective-repeat"><a href="#Selective-repeat" class="headerlink" title="Selective repeat"></a>Selective repeat</h5><ul>
<li>receiver individually acknowledges all correctly received pkts<ul>
<li>buffers pkts, as needed, for eventual in-order delivery  to upper layer</li>
</ul>
</li>
<li>sender only resends pkts for which ACK not received<ul>
<li>sender timer for each unACKed pkt</li>
</ul>
</li>
<li>sender window<ul>
<li>N consecutive seq #’ s </li>
<li>limits seq #s of sent, unACKed pkts</li>
</ul>
</li>
</ul>
<p>sender, receiver windows:</p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220416152017690.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220416152017690.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220416152017690" style="zoom:50%;">

<ul>
<li><p>sender</p>
<p>data from above:</p>
<ul>
<li>if next available seq # in window, send pkt</li>
<li>timeout(n):  resend pkt n, restart timers</li>
</ul>
<p>ACK(n) in [sendbase,sendbase+N]:</p>
<ul>
<li>mark pkt n as received</li>
<li>if n smallest unACKed pkt, advance window base to next unACKed seq #</li>
</ul>
</li>
<li><p>receiver</p>
<p>pkt n in [rcvbase, rcvbase+N-1]</p>
<ul>
<li>send ACK(n)</li>
<li>out-of-order: buffer</li>
<li>in-order: deliver (also deliver buffered, in-order pkts), advance window to next not-yet-received pkt</li>
</ul>
<p>pkt n in [rcvbase-N,rcvbase-1]</p>
<ul>
<li>ACK(n)</li>
</ul>
<p>otherwise:</p>
<ul>
<li>ignore</li>
</ul>
</li>
</ul>
<p>Selective repeat in action:</p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220416152624877.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220416152624877.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220416152624877" style="zoom:50%;">

<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220416152720926.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220416152720926.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220416152720926" style="zoom:50%;">







<h3 id="3-5-connection-oriented-transport-TCP"><a href="#3-5-connection-oriented-transport-TCP" class="headerlink" title="3.5 connection-oriented transport: TCP"></a>3.5 connection-oriented transport: TCP</h3><h4 id="3-5-1-Overview"><a href="#3-5-1-Overview" class="headerlink" title="3.5.1 Overview"></a>3.5.1 Overview</h4><ul>
<li>point-to-point:<ul>
<li>one sender, one receiver</li>
</ul>
</li>
<li>reliable, in-order byte steam:<ul>
<li>no “message boundaries”</li>
</ul>
</li>
<li>pipelined:<ul>
<li>TCP congestion and flow control set window size</li>
</ul>
</li>
<li>full duplex data<ul>
<li>bi-directional data flow in same connection</li>
<li>MSS: maximum segment size</li>
</ul>
</li>
<li>connection-oriented:<ul>
<li>handshaking (exchange of control messages) initiates sender, receiver state before data exchange</li>
</ul>
</li>
<li>flow controlled:<ul>
<li>sender will not overwhelm receiver</li>
</ul>
</li>
</ul>
<h4 id="3-5-2-segment-structure"><a href="#3-5-2-segment-structure" class="headerlink" title="3.5.2  segment structure"></a>3.5.2  segment structure</h4><img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220416153436606.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220416153436606.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220416153436606" style="zoom: 33%;">



<h5 id="TCP-seq-numbers-ACKs"><a href="#TCP-seq-numbers-ACKs" class="headerlink" title="TCP seq. numbers, ACKs"></a>TCP seq. numbers, ACKs</h5><img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220416153840516.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220416153840516.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220416153840516" style="zoom:50%;">



<ul>
<li>sequence numbers:<ul>
<li>byte stream “number” of first byte in segment’ s data</li>
</ul>
</li>
<li>acknowledgements:<ul>
<li>sequence number of next byte expected from other sides</li>
<li>cumulative ACK</li>
</ul>
</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220416153915735.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220416153915735.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220416153915735" style="zoom:50%;">

<h5 id="round-trip-time-timeout"><a href="#round-trip-time-timeout" class="headerlink" title="round trip time, timeout"></a>round trip time, timeout</h5><p>how to set TCP timeout value?</p>
<ul>
<li>longer than RTT<ul>
<li>but RTT varies</li>
</ul>
</li>
<li>Too short: premature timeout, unnecessary retransmissions</li>
<li>Too long: slow reaction to segment loss</li>
</ul>
<p>how to estimate RTT?</p>
<ul>
<li><p>SampleRTT: measured time from segment transmission until ACK receipt</p>
<ul>
<li>ignore retransmissions</li>
</ul>
</li>
<li><p>SampleRTT will vary, want estimated RTT “smoother”</p>
<ul>
<li>average several recent measurements, not just current SampleRTT</li>
</ul>
</li>
<li><p>EstimatedRTT &#x3D; (1- a)<em>EstimatedRTT + a</em>SampleRTT</p>
<ul>
<li>exponential weighted moving average</li>
<li>influence of past sample decreases exponentially fast</li>
<li>typical value: a &#x3D; 0.125</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220416154606769.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220416154606769.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220416154606769" style="zoom: 50%;">


</li>
<li><p>timeout interval: EstimatedRTT plus “safety margin”</p>
<ul>
<li>large variation in EstimatedRTT -&gt; larger safety margin</li>
</ul>
</li>
<li><p>estimate SampleRTT deviate from EstimatedRTT:</p>
<ul>
<li>DevRTT &#x3D; (1-B)<em>DevRTT + B</em>|SampleRTT-EstimatedRTT|(typically, B &#x3D; 0.25)</li>
</ul>
</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220416154853734.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220416154853734.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220416154853734" style="zoom:50%;">



<h4 id="3-5-3-reliable-data-transfer"><a href="#3-5-3-reliable-data-transfer" class="headerlink" title="3.5.3 reliable data transfer"></a>3.5.3 reliable data transfer</h4><ul>
<li>TCP creates rdt service on top of IP’s unreliable service<ul>
<li>pipelined segments</li>
<li>cumulative acks</li>
<li>single retransmission timer</li>
</ul>
</li>
<li>retransmissions triggered by:<ul>
<li>timeout events </li>
<li>duplicate acks</li>
</ul>
</li>
</ul>
<h5 id="sender-events"><a href="#sender-events" class="headerlink" title="sender events:"></a>sender events:</h5><p>data rcvd from app:</p>
<ul>
<li>create segment with sequence #</li>
<li>sequence # is byte-stream number of first data byte in segment</li>
<li>start timer if not already running<ul>
<li>think of timer as for oldest unacked segment</li>
<li>expiration interval: TimeOutInterval</li>
</ul>
</li>
</ul>
<p>timeout:</p>
<ul>
<li>retransmit segment that caused timeout</li>
<li>restart timer</li>
</ul>
<p>ack rcvd:</p>
<ul>
<li>if ack acknowledges previously unacked segments<ul>
<li>update what is known  to be ACKed</li>
<li>start timer if there are still unacked segments</li>
</ul>
</li>
</ul>
<p>sender (simplified):</p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220416155622599.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220416155622599.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220416155622216" style="zoom:50%;">



<h5 id="Three-retransmission-scenarios"><a href="#Three-retransmission-scenarios" class="headerlink" title="Three retransmission scenarios"></a>Three retransmission scenarios</h5><img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220420190211041.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220420190211041.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220420190211041" style="zoom:50%;">



<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220420190229132.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220420190229132.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220420190229132" style="zoom:50%;">

<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220420190243034.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220420190243034.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220420190243034" style="zoom:50%;">



<h5 id="ACK-generation"><a href="#ACK-generation" class="headerlink" title="ACK generation"></a>ACK generation</h5><img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220420190427513.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220420190427513.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220420190427513" style="zoom:50%;">



<h5 id="fast-retransmit"><a href="#fast-retransmit" class="headerlink" title="fast retransmit"></a>fast retransmit</h5><ul>
<li>time-out period often relatively long:<ul>
<li>long delay before  resending lost packet</li>
</ul>
</li>
<li>detect lost segments via duplicate ACKs.<ul>
<li>sender often sends many segments back-to-back</li>
<li>if segment is lost, there will likely be many duplicate ACKs.</li>
</ul>
</li>
</ul>
<p>TCP fast retransmit</p>
<p>if sender receives 3 ACKs for same data (“triple duplicate ACKs”), resend unacked segment with smallest sequence number</p>
<ul>
<li>likely that unacked segment lost, so don’ t wait for timeout</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220420190705325.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220420190705325.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220420190705325" style="zoom:50%;">



<h4 id="3-5-4-flow-control"><a href="#3-5-4-flow-control" class="headerlink" title="3.5.4 flow control"></a>3.5.4 flow control</h4><ul>
<li><p>flow control</p>
<p>receiver controls sender, so sender won’t overflow receiver’s buffer by transmitting too much, too fast</p>
</li>
<li><p>receiver “advertises” free buffer space by including rwnd value in TCP header of receiver-to-sender segments</p>
<ul>
<li>RcvBuffer size set via socket options (typical default  is 4096 bytes)</li>
<li>many operating systems autoadjust RcvBuffer</li>
</ul>
</li>
<li><p>sender limits amount of unacked (“in-flight”) data to receiver’ s rwnd value</p>
</li>
<li><p>guarantees receive buffer will not overflow</p>
</li>
</ul>
<h4 id="3-5-5-Connection-Management"><a href="#3-5-5-Connection-Management" class="headerlink" title="3.5.5 Connection Management"></a>3.5.5 Connection Management</h4><p>before exchanging data, sender&#x2F;receiver “<strong>handshake</strong>” :</p>
<ul>
<li><p>agree to establish connection (each knowing the other willing  to establish connection)</p>
</li>
<li><p>agree on connection parameters</p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220420191422292.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220420191422292.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220420191422292" style="zoom:50%;"></li>
</ul>
<h5 id="Handshake"><a href="#Handshake" class="headerlink" title="Handshake"></a>Handshake</h5><h6 id="2-way-handshake"><a href="#2-way-handshake" class="headerlink" title="2-way handshake:"></a>2-way handshake:</h6><img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220420191522523.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220420191522523.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220420191522523" style="zoom:50%;">

<p>Q: will 2-way handshake always work in network?</p>
<ul>
<li>variable delays</li>
<li>retransmitted messages (e.g.  req_conn(x)) due to message loss</li>
<li>message reordering</li>
<li>can’t “see” other side</li>
</ul>
<p>2-way handshake failure scenarios:</p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220420191727771.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220420191727771.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220420191727771" style="zoom:50%;">



<h6 id="3-way-handshake"><a href="#3-way-handshake" class="headerlink" title="3-way handshake"></a>3-way handshake</h6><img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220420191929314.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220420191929314.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220420191929314" style="zoom:50%;">



<p>3-way handshake: FSM</p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220420192010094.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220420192010094.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220420192010094" style="zoom:50%;">

<h5 id="closing-a-connection"><a href="#closing-a-connection" class="headerlink" title="closing a connection"></a>closing a connection</h5><ul>
<li>client, server each close their side of connection<ul>
<li>send TCP segment with FIN bit &#x3D; 1</li>
</ul>
</li>
<li>respond to received FIN with ACK<ul>
<li>on receiving FIN, ACK can be combined with own FIN</li>
</ul>
</li>
<li>simultaneous FIN exchanges can be handled</li>
<li><img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220420192224668.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220420192224668.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220420192224668" style="zoom:50%;"></li>
</ul>
<h3 id="3-6-principles-of-congestion-control"><a href="#3-6-principles-of-congestion-control" class="headerlink" title="3.6 principles of congestion control"></a>3.6 principles of congestion control</h3><p>congestion:</p>
<ul>
<li>informally: “too many sources sending too much data too fast for network to handle”</li>
<li>different from flow control!</li>
<li>manifestations:<ul>
<li>lost packets (buffer overflow at routers) </li>
<li>long delays (queueing in router buffers)</li>
</ul>
</li>
</ul>
<h4 id="3-6-1-Causes-x2F-costs-of-congestion"><a href="#3-6-1-Causes-x2F-costs-of-congestion" class="headerlink" title="3.6.1 Causes&#x2F;costs of congestion"></a>3.6.1 Causes&#x2F;costs of congestion</h4><h5 id="scenario-1："><a href="#scenario-1：" class="headerlink" title="scenario 1："></a>scenario 1：</h5><ul>
<li>two senders, two receivers</li>
<li>one router, infinite buffers</li>
<li>output link capacity: R</li>
<li>no retransmission</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421174933277.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421174933277.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220421174933277" style="zoom:50%;">

<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421174951886.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421174951886.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220421174951886" style="zoom:50%;">



<h5 id="scenario-2："><a href="#scenario-2：" class="headerlink" title="scenario 2："></a>scenario 2：</h5><ul>
<li><p>one router, finite buffers</p>
</li>
<li><p>sender retransmission of timed-out packet</p>
<ul>
<li>application-layer input &#x3D; application-layer output: in &#x3D;  out</li>
<li>transport-layer input includes retransmissions : in’ &gt;&#x3D; in</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421175211464.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421175211464.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220421175211464" style="zoom:50%;">


</li>
<li><p>idealization: perfect knowledge</p>
<ul>
<li>sender sends only when router buffers available</li>
</ul>
</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421175518944.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421175518944.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220421175518944" style="zoom:50%;">

<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421175539551.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421175539551.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220421175539551" style="zoom:50%;">

<ul>
<li>Idealization: known loss packets can be lost, dropped at router due to full buffers<ul>
<li>sender only resends if packet known to be lost</li>
</ul>
</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421175706509.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421175706509.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220421175706509" style="zoom:50%;">

<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421175734693.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421175734693.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220421175734693" style="zoom:50%;">



<p>Realistic: duplicates：</p>
<ul>
<li>packets can be lost, dropped at  router due to full buffers</li>
<li>sender times out prematurely, sending two copies, both of which are delivered</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421180007942.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421180007942.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220421180007942" style="zoom:50%;">

<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421180029759.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421180029759.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220421180029759" style="zoom: 33%;">



<p>“costs” of congestion:</p>
<ul>
<li>more work (retrans) for given “goodput”</li>
<li>unneeded retransmissions: link carries multiple copies of pkt<ul>
<li>decreasing goodput</li>
</ul>
</li>
</ul>
<h5 id="scenario-3"><a href="#scenario-3" class="headerlink" title="scenario 3:"></a>scenario 3:</h5><ul>
<li>four senders</li>
<li>multiple paths</li>
<li>timeout&#x2F;retransmit</li>
</ul>
<p>Q: what happens as in and in’ increase ?</p>
<p>A: as red in’ increases, all arriving  blue pkts at upper queue are dropped, blue throughput&#x3D;0</p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421180609262.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421180609262.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220421180609262" style="zoom:50%;">

<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421180628190.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421180628190.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220421180628190" style="zoom:50%;">

<p>another “cost” of congestion:</p>
<p>when packet dropped, any “ upstream transmission capacity used for that packet was wasted!</p>
<h3 id="3-7-TCP-congestion-control"><a href="#3-7-TCP-congestion-control" class="headerlink" title="3.7 TCP congestion control"></a>3.7 TCP congestion control</h3><h4 id="3-7-1-additive-increase-multiplicative-decrease"><a href="#3-7-1-additive-increase-multiplicative-decrease" class="headerlink" title="3.7.1 additive increase multiplicative decrease"></a>3.7.1 additive increase multiplicative decrease</h4><ul>
<li>approach:sender increases transmission rate (window  size), probing for usable bandwidth, until loss occurs<ul>
<li>additive increase: increase cwnd by 1 MSS every RTT until loss detected</li>
<li>multiplicative decrease: cut cwnd in half after loss</li>
</ul>
</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421181142072.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421181142072.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220421181142072" style="zoom:50%;">



<h4 id="3-7-2-details"><a href="#3-7-2-details" class="headerlink" title="3.7.2 details"></a>3.7.2 details</h4><img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421181303242.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421181303242.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220421181303242" style="zoom:50%;">

<ul>
<li><p>sender limits transmission:</p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421181353780.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421181353780.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220421181353780" style="zoom:50%;">
</li>
<li><p>cwnd is dynamic, function of perceived network congestion</p>
</li>
</ul>
<p>TCP sending rate:</p>
<ul>
<li><p>roughly: send cwnd bytes, wait RTT for ACKS, then send more bytes</p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421181504644.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421181504644.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220421181504644" style="zoom:50%;"></li>
</ul>
<h4 id="3-7-3-Slow-Start"><a href="#3-7-3-Slow-Start" class="headerlink" title="3.7.3 Slow Start"></a>3.7.3 Slow Start</h4><ul>
<li>when connection begins, increase rate exponentially until first loss event<ul>
<li>initially cwnd &#x3D; 1 MSS</li>
<li>double cwnd every RTT</li>
<li>done by incrementing</li>
<li>cwnd for every ACK received</li>
</ul>
</li>
<li>summary: initial rate is slow but ramps up exponentially fast</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421181739650.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421181739650.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220421181739650" style="zoom:50%;">



<h5 id="Detecting-reacting-to-loss"><a href="#Detecting-reacting-to-loss" class="headerlink" title="Detecting, reacting to loss"></a>Detecting, reacting to loss</h5><ul>
<li>loss indicated by timeout:<ul>
<li>cwnd set to 1 MSS</li>
<li>window then grows exponentially (as in slow start) to threshold, then grows linearly</li>
</ul>
</li>
<li>loss indicated by 3 duplicate ACKs: TCP RENO<ul>
<li>dup ACKs indicate network capable of delivering  some segments</li>
<li>cwnd is cut in half window then grows linearly</li>
</ul>
</li>
<li>TCP Tahoe always sets cwnd to 1 (timeout or 3  duplicate acks)</li>
</ul>
<h5 id="switching-from-slow-start-to-CA"><a href="#switching-from-slow-start-to-CA" class="headerlink" title="switching from slow start to CA"></a>switching from slow start to CA</h5><p>Q: when should the exponential increase switch to linear?</p>
<p>A: when cwnd gets to 1&#x2F;2 of its value before timeout.</p>
<p>Implementation:</p>
<ul>
<li>variable ssthresh </li>
<li>on loss event, ssthresh is set to 1&#x2F;2 of cwnd just before loss event</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421182340610.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421182340610.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220421182340610" style="zoom:50%;">



<h5 id="summary"><a href="#summary" class="headerlink" title="summary"></a>summary</h5><img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421182803514.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421182803514.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220421182803514" style="zoom:50%;">





<h4 id="3-7-4-throughput"><a href="#3-7-4-throughput" class="headerlink" title="3.7.4 throughput"></a>3.7.4 throughput</h4><ul>
<li><p>avg. TCP thruput as function of window size, RTT?</p>
<ul>
<li>ignore slow start, assume always data to send</li>
</ul>
</li>
<li><p>W: window size (measured in bytes) where loss occurs</p>
<ul>
<li><p>avg. window size (# in-flight bytes) is ¾ W</p>
</li>
<li><p>avg. thruput is 3&#x2F;4W per RTT</p>
</li>
</ul>
</li>
</ul>
<p>avg TCP thruput &#x3D; 3&#x2F;4*(W&#x2F;RTT) bytes&#x2F;sec</p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421183126830.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421183126830.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220421183126830" style="zoom:50%;">



<p>TCP over “long, fat pipes”</p>
<ul>
<li><p>example: 1500 byte segments, 100ms RTT, want 10 Gbps throughput</p>
</li>
<li><p>requires W &#x3D; 83,333 in-flight segments</p>
</li>
<li><p>requires W &#x3D; 83,333 in-flight segments</p>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421183517456.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421183517456.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220421183517456" style="zoom:50%;">
</li>
<li><p>to achieve 10 Gbps throughput, need a loss rate of L  &#x3D; 2·10^(-10) – a very small loss rate!</p>
</li>
</ul>
<h3 id="3-8-Fairness"><a href="#3-8-Fairness" class="headerlink" title="3.8 Fairness"></a>3.8 Fairness</h3><ul>
<li>fairness goal: if K TCP sessions share same bottleneck link of bandwidth R, each should have average rate of R&#x2F;K</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421183714886.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421183714886.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220421183714886" style="zoom:50%;">

<h4 id="3-8-1-Why-is-TCP-fair"><a href="#3-8-1-Why-is-TCP-fair" class="headerlink" title="3.8.1 Why is TCP fair"></a>3.8.1 Why is TCP fair</h4><p>two competing sessions:</p>
<ul>
<li>additive increase gives slope of 1, as throughout increases</li>
<li>multiplicative decrease decreases throughput proportionally</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421183838551.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421183838551.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220421183838551" style="zoom:50%;">



<h4 id="3-8-2-More-about-Fairness"><a href="#3-8-2-More-about-Fairness" class="headerlink" title="3.8.2 More about Fairness"></a>3.8.2 More about Fairness</h4><p>Fairness and UDP</p>
<ul>
<li><p>multimedia apps often do not use TCP </p>
<ul>
<li>do not want rate throttled by congestion control</li>
</ul>
</li>
<li><p>instead use UDP:</p>
<ul>
<li>send audio&#x2F;video at constant rate, tolerate packet loss</li>
</ul>
</li>
</ul>
<p>Fairness, parallel TCP connections</p>
<ul>
<li>application can open multiple parallel connections between two hosts</li>
<li>web browsers do this</li>
<li>link of rate R with 9 existing connections:<ul>
<li>new app asks for 1 TCP, gets rate R&#x2F;10</li>
<li>new app asks for 11 TCPs, gets R&#x2F;2</li>
</ul>
</li>
</ul>
<p>3.9 ECN</p>
<p>Explicit Congestion Notification (ECN)</p>
<ul>
<li>network-assisted congestion control:</li>
<li>congestion indication carried to receiving host</li>
<li>receiver (seeing congestion indication in IP datagram) sets ECE bit on receiver-to-sender ACK segment to notify sender of congestion</li>
</ul>
<img src="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421184548650.png" class="lazyload placeholder" data-srcset="https://blogpicture01.oss-cn-beijing.aliyuncs.com/img/image-20220421184548650.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="image-20220421184548650" style="zoom:50%;">


      </div>
      <div class="post-tags-categories">
        
        <div class="tags">
          
            <a href="/tags/learning/" class="">
              learning
            </a>
          
        </div>
        
      </div>
      
        <div class="copyright">
  <ul class="post-copyright">
    <li class="post-copyright-author">
    <strong>作者:  </strong>何星林</a>
    </li>
    <li class="post-copyright-link">
    <strong>文章链接:  </strong>
    <a href="/2022/02/24/computer-network/" target="_blank" title="computer network">http://khdiu.github.io/2022/02/24/computer-network/</a>
    </li>
    <li class="post-copyright-license">
      <strong>版权声明:   </strong>
      本网站所有文章除特别声明外,均采用 <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">CC BY-NC-ND 4.0</a>
      许可协议。转载请注明出处!
    </li>
  </ul>
<div>
      
    </article>
    <!-- 上一篇文章和下一篇文章 -->
    
      <!-- 文章详情页的上一页和下一页 -->
<div class="post-nav">



  
  <div class="post-nav-prev post-nav-item">
    <div class="post-nav-img" style="background-size: cover; 
      background-position: center center;">
      <img class="lazyload lazyload placeholder" src="https://pic4.zhimg.com/80/v2-e434e3a2888fb4efb1844845b8791d1f_1440w.webp" class="lazyload placeholder" data-srcset="https://pic4.zhimg.com/80/v2-e434e3a2888fb4efb1844845b8791d1f_1440w.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="">
    </div>
    <a href="/2022/02/28/Introduction%20to%20software%20engineer/" class="post-nav-link">
      <div class="title">
        <i class="fas fa-angle-left"></i> 上一篇:
        <div class="title-text">Introduction to software engineer</div>
      </div>
      
      <!-- <div class="content">
        Introduction to software engineer1.Software and Software Eng
      </div> -->
    </a>
  </div>



  
  <div class="post-nav-next post-nav-item">
    <div class="post-nav-img" style="background-size: cover; 
      background-position: center center;">
      <img class="lazyload lazyload placeholder" src="https://pic3.zhimg.com/80/v2-5f7cb7e900b9dcf5354c3d4d2c5cc3c2_1440w.webp" class="lazyload placeholder" data-srcset="https://pic3.zhimg.com/80/v2-5f7cb7e900b9dcf5354c3d4d2c5cc3c2_1440w.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" src="" alt="">
    </div>
    <a href="/2022/02/23/servelet/" class="post-nav-link">
      <div class="title">
        下一篇: <i class="fas fa-angle-right"></i>
        <div class="title-text">servelet学习</div>
      </div>
      <!-- <div class="content">
        javawebTomcat: web 应用服务器
servletweb开发基石，与平台无关的服务器组件，负责与客户端进行
      </div> -->
    </a>
  </div>

</div>

    
    

    <!-- 打赏 -->
    
      <div id="appDonate" class="post-donate">
  <div id="donate_board" class="donate_bar center" ref="donate">
    <a id="btn_donate" class="btn_donate" href="javascript:;" title="打赏" @click="showDialogDrawer()"></a>
  </div>
  <transition name="fade">
    <div 
      class="donate-box-mask"
      v-cloak 
      v-show="visible"
      @click="cancelDialogDrawer()"
    >
    </div>
  </transition>
  <transition name="bounce">
    <div class="donate-box" v-cloak v-show="visible">
      <div class="donate-box_close">
        <i class="fas fa-times" aria-hidden="true" @click="cancelDialogDrawer" pointer></i>
      </div>
      <div class="donate-box_title">
        <h4>
          你的赏识是我前进的动力
        </h4>
      </div>
      <div class="donate-box_tab">
        <div class="Alipay" pointer :class="{'active': tabActive === 'Alipay'}" @click="changeTabActive('Alipay')">
          支付宝
        </div>
        <div class="WeChatpay" pointer :class="{'active': tabActive === 'WeChatpay'}" @click="changeTabActive('WeChatpay')">
          微信
        </div>
      </div>
      <div class="donate-box_img">
        <div class="AlipayImg" v-show="tabActive === 'Alipay'">
          <img src="https://pica.zhimg.com/80/v2-61f99f8dcf899f54cad2a1aa28b21e44_1440w.webp" class="lazyload placeholder" data-srcset="https://pica.zhimg.com/80/v2-61f99f8dcf899f54cad2a1aa28b21e44_1440w.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="支付宝打赏" />
        </div> 
        <div class="WeChatpayImg" v-show="tabActive === 'WeChatpay'">
          <img src="https://pic2.zhimg.com/80/v2-29e78b52051ce542adf6d786d61fbd19_1440w.webp" class="lazyload placeholder" data-srcset="https://pic2.zhimg.com/80/v2-29e78b52051ce542adf6d786d61fbd19_1440w.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="微信打赏" />
        </div>
      </div>
    </div>
  </transition>
</div>

<script>
  var body = document.body || document.documentElement || window;
  var vm = new Vue({
    el: '#appDonate',
    data: {
      visible: false,
      tabActive: 'Alipay',
      top: 0,
    },
    computed: {
    },
    mounted() {
    },
    methods: {
      showDialogDrawer() {
        this.visible = true;
        // 防止页面滚动，只能让弹框滚动
        // function getScroll() {
        //   return {
        //     left: window.pageXOffset || document.documentElement.scrollLeft || document.body.scrollLeft || 0,
        //     top: window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0
        //   };
        // }
        this.top = $(document).scrollTop() // or getScroll().top
        // console.log('aa', $('.main-content'));
        body.style.cssText = 'overflow: hidden;';
      },
      cancelDialogDrawer() {
        this.visible = false;
        body.removeAttribute('style');
        $(document).scrollTop(this.top)
      },
      changeTabActive(name) {
        this.tabActive = name;
      }
    },
    created() {}
  })
</script>
    

    <!-- 分享 -->
    
      <!-- https://github.com/overtrue/share.js -->
<!-- 文章详情页的分享 -->
<div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>

<script src="/js/shareJs/social-share.min.js"></script>
</script>

<style>
  .social-share {
    margin: 20px 0;
  }
</style>


    
    
    <!-- 评论 -->
    <!-- 评论 -->

  <div id="myComment">
    
      <div id="gitment-container"></div>

    
  </div>

<!-- comment script in themes\hexo-theme-bamboo\layout\_partial\scripts\index.ejs -->


  </div>

  <!-- 目录 -->
  <aside id='l_side'>
  
    
      <section class="widget side_blogger">
  <div class='content'>
    
      
        <a class='avatar flat-box rectangle' href='/about/'>
          <img src='https://blogpicture01.oss-cn-beijing.aliyuncs.com/blogbackground/homepage/yotailang%20.jpg'/>
        </a>
      
    
    
      <div class='text'>
        
          <h2>何星林</h2>
        
        
          <p>早起每一天</p>

        
        
      </div>
    
    
      <div class="social-wrapper">
        
          
            <a href="mailto:khdiue@gmail.com"
              class="social fas fa-envelope flat-btn"
              target="_blank"
              rel="external nofollow noopener noreferrer">
              
            </a>
          
        
          
            <a href="https://github.com/khdiu"
              class="social fab fa-github flat-btn"
              target="_blank"
              rel="external nofollow noopener noreferrer">
              
            </a>
          
        
          
            <a href="tencent://AddContact/?fromId=50&amp;fromSubId=1&amp;subcmd=all&amp;uin=1179763684"
              class="social fab fa-qq flat-btn"
              target="_blank"
              rel="external nofollow noopener noreferrer">
              
            </a>
          
        
      </div>
    
  </div>
</section>

    
  
  
  

  <div class="layout_sticky">    
    
      
<section class="widget side_toc">
  
  <header>
    
      <i style="color: " class="fas fa-list fa-fw" aria-hidden="true"></i><span class='name' style="color: ">本文目录</span>
    
  </header>


  <div class='content'>
    <div class="toc-main">
      <div class="toc-content">
        <!-- <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#computer-network"><span class="toc-text">computer network</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-chapter1-computer-networks-and-the-Internet"><span class="toc-text">1.chapter1  computer networks and the Internet</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Internet"><span class="toc-text">Internet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Protocol"><span class="toc-text">Protocol</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1network-structure"><span class="toc-text">1.1network structure</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2network-edge"><span class="toc-text">1.2network edge</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ISP-internet-service-provider"><span class="toc-text">ISP(internet service provider)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Access-networks"><span class="toc-text">Access networks</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sending-message"><span class="toc-text">sending message</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Physical-media"><span class="toc-text">Physical media</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3network-core"><span class="toc-text">1.3network core</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Packet-switch-store-and-forward"><span class="toc-text">Packet-switch: store-and-forward</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Packet-switching-queueing-delaying-loss"><span class="toc-text">Packet-switching: queueing delaying,loss</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Tow-key-network-core-functions"><span class="toc-text">Tow key network-core functions</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Alternative-core-circuit-switching"><span class="toc-text">Alternative core: circuit switching</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#FDM-versus-TDM"><span class="toc-text">FDM versus TDM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Packet-switching-versus-circuit-switching"><span class="toc-text">Packet switching versus circuit switching</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Internet-structure-network-of-networks"><span class="toc-text">Internet structure: network of networks</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4Delay-loss-and-throughput-in-packet-switched-Networks"><span class="toc-text">1.4Delay,loss,and throughput in packet-switched Networks</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Delay"><span class="toc-text">Delay:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Queuing-delay-and-packet-loss"><span class="toc-text">Queuing delay and packet loss</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Throughput"><span class="toc-text">Throughput</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5Protocol-layers-service-models"><span class="toc-text">1.5Protocol layers, service models</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Layers"><span class="toc-text">Layers:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Encapsulation"><span class="toc-text">Encapsulation:</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Homework1-supplements-%EF%BC%88extension-and-correct%EF%BC%89"><span class="toc-text">Homework1 supplements （extension and correct）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-chaper2-Application-layer"><span class="toc-text">2. chaper2 Application layer</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Outline"><span class="toc-text">Outline:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-principles-of-network-applications"><span class="toc-text">2.1 principles of network applications</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-Goals%EF%BC%9A"><span class="toc-text">2.1.1 Goals：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-2-Creating-a-network-app"><span class="toc-text">2.1.2 Creating a network app</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-3-Application-architectures"><span class="toc-text">2.1.3 Application architectures</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-4-Client-server-architecture"><span class="toc-text">2.1.4 Client-server architecture</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-5-P2P-architecture"><span class="toc-text">2.1.5 P2P architecture</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-6-Processes-communicating"><span class="toc-text">2.1.6 Processes communicating</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-7-Sockets"><span class="toc-text">2.1.7 Sockets</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-8-Addressing-processes"><span class="toc-text">2.1.8 Addressing processes</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-9App-layer-protocol-defines"><span class="toc-text">2.1.9App-layer protocol defines</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-10-What-transport-service-does-an-app-need"><span class="toc-text">2.1.10 What transport service does an app need?</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#data-integrity"><span class="toc-text">data integrity</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-11-Transport-service-requirements-common-apps"><span class="toc-text">2.1.11 Transport service requirements: common apps</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-12-Internet-transport-protocols-services"><span class="toc-text">2.1.12 Internet transport protocols services</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-13-Internet-apps-application-transport-protocols"><span class="toc-text">2.1.13 Internet apps: application, transport protocols</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-14-Securing-TCP"><span class="toc-text">2.1.14 Securing TCP</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-Web-and-HTTP"><span class="toc-text">2.2 Web and HTTP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-Preview"><span class="toc-text">2.2.1 Preview</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-2-HTTP-overview"><span class="toc-text">2.2.2 HTTP overview</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-3-HTTP-connections"><span class="toc-text">2.2.3 HTTP connections</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Non-persistent-HTTP"><span class="toc-text">Non-persistent HTTP</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Non-persistent-HTTP-response-time"><span class="toc-text">Non-persistent HTTP: response time</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Persistent-HTTP"><span class="toc-text">Persistent HTTP</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-4-HTTP-request-message"><span class="toc-text">2.2.4 HTTP request message</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#HTTP-request-message-general-format"><span class="toc-text">HTTP request message: general format</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Uploading-form-input"><span class="toc-text">Uploading form input</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Method-types"><span class="toc-text">Method types</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-5-HTTP-response-message"><span class="toc-text">2.2.5 HTTP response message</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#HTTP-response-status-codes"><span class="toc-text">HTTP response status codes</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#User-server-state-cookies"><span class="toc-text">User-server state: cookies</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Cookies-keeping-%E2%80%9C-state-%E2%80%9D"><span class="toc-text">Cookies: keeping “ state ”</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-6-Web-caches-proxy-server"><span class="toc-text">2.2.6 Web caches (proxy server)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#More-about-Web-caching"><span class="toc-text">More about Web caching:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Conditional-GET"><span class="toc-text">Conditional GET</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-Electronic-mail"><span class="toc-text">2.3 Electronic mail</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-preview"><span class="toc-text">2.3.1 preview</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-2-SMTP-RFC-2821"><span class="toc-text">2.3.2 SMTP [RFC 2821]</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Scenario-Alice-sends-message-to-Bob"><span class="toc-text">Scenario: Alice sends message to Bob</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Final-words"><span class="toc-text">Final words</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-3-Mail-message-format"><span class="toc-text">2.3.3 Mail message format</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-4-Mail-access-protocols"><span class="toc-text">2.3.4 Mail access protocols</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-5-POP3-protocol"><span class="toc-text">2.3.5 POP3 protocol</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#POP3-more-and-IMAP"><span class="toc-text">POP3 (more) and IMAP</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-DNS"><span class="toc-text">2.4 DNS</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-1-preview"><span class="toc-text">2.4.1 preview</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-2-services-structure"><span class="toc-text">2.4.2 services, structure</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-3-hierarchical-database"><span class="toc-text">2.4.3 hierarchical database</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#root-name-servers"><span class="toc-text">root name servers</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#TLD-and-authoritative-servers"><span class="toc-text">TLD and authoritative servers</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Local-DNS-name-server"><span class="toc-text">Local DNS name server</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#DNS-name-resolution-example"><span class="toc-text">DNS name  resolution example</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-5-caching-updating-records"><span class="toc-text">2.4.5 caching, updating records</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-6-DNS-records"><span class="toc-text">2.4.6 DNS records</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-7-protocol-messages"><span class="toc-text">2.4.7 protocol, messages</span></a></li><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-text"></span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-8-Inserting-records-into-DNS"><span class="toc-text">2.4.8 Inserting records into DNS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-9-Attacking-DNS"><span class="toc-text">2.4.9 Attacking DNS</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-P2P-applications"><span class="toc-text">2.5 P2P applications</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-1-Pure-P2P-architecture"><span class="toc-text">2.5.1 Pure P2P architecture</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-2-File-distribution-client-server-vs-P2P"><span class="toc-text">2.5.2 File distribution: client-server vs P2P</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#File-distribution-time-client-server"><span class="toc-text">File distribution time: client-server</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#File-distribution-time-P2P"><span class="toc-text">File distribution time: P2P</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-3-BitTorrent"><span class="toc-text">2.5.3  BitTorrent</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#requesting-sending-file-chunks"><span class="toc-text">requesting, sending file chunks</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#tit-for-tat"><span class="toc-text">tit-for-tat</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-video-streaming-and-content-delivery-networks-CDNs"><span class="toc-text">2.6 video streaming and content delivery networks (CDNs)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6-1-Video-Streaming-and-CDNs-context"><span class="toc-text">2.6.1 Video Streaming and CDNs: context</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6-2-Multimedia-video"><span class="toc-text">2.6.2 Multimedia: video</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6-3-Streaming-multimedia-DASH"><span class="toc-text">2.6.3 Streaming multimedia: DASH</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6-4-Content-distribution-networks-CDNs"><span class="toc-text">2.6.4 Content distribution networks(CDNs)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#closer-look"><span class="toc-text">closer look</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7-socket-programming-with-UDP-and-TCP"><span class="toc-text">2.7 socket programming  with UDP and TCP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-7-1-Socket-programming"><span class="toc-text">2.7.1 Socket programming</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-7-2-UDP"><span class="toc-text">2.7.2  UDP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-1"><span class="toc-text"></span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-7-3-TCP"><span class="toc-text">2.7.3  TCP</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Homework2-supplements-extension-and-correct"><span class="toc-text">Homework2 supplements (extension and correct)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-chapter3-Transport-layer"><span class="toc-text">3. chapter3 Transport layer</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#prevew"><span class="toc-text">prevew:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-transport-layer-service"><span class="toc-text">3.1 transport-layer service</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-1-Transport-services-and-protocols"><span class="toc-text">3.1.1 Transport services and protocols</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-2-Transport-vs-network-layer"><span class="toc-text">3.1.2 Transport vs. network layer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-3-Internet-transport-layer-protocols"><span class="toc-text">3.1.3 Internet transport-layer protocols</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-multiplexing-and-demultiplexing"><span class="toc-text">3.2 multiplexing and demultiplexing</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-1-Multiplexing-x2F-demultiplexing"><span class="toc-text">3.2.1 Multiplexing&#x2F;demultiplexing</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-2-How-demultiplexing-works"><span class="toc-text">3.2.2 How demultiplexing works</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-3-Connectionless-demultiplexing"><span class="toc-text">3.2.3 Connectionless demultiplexing</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-4-Connection-oriented-demux"><span class="toc-text">3.2.4 Connection-oriented demux</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-connectionless-transport-UDP"><span class="toc-text">3.3 connectionless transport: UDP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-1-UDP-User-Datagram-Protocol"><span class="toc-text">3.3.1 UDP: User Datagram Protocol</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-2-UDP-segment-header"><span class="toc-text">3.3.2 UDP: segment header</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-3-UDP-checksum"><span class="toc-text">3.3.3 UDP checksum</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Internet-checksum-example"><span class="toc-text">Internet checksum: example</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-principles-of-reliable-data-transfer"><span class="toc-text">3.4 principles of reliable data transfer</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-1-reliable-data-transfer"><span class="toc-text">3.4.1 reliable data transfer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-2-getting-started"><span class="toc-text">3.4.2 getting started</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-3-rdt1-0"><span class="toc-text">3.4.3 rdt1.0</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-4-rdt2-0"><span class="toc-text">3.4.4 rdt2.0</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#FSM-specification"><span class="toc-text">FSM specification</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#A-fatal-flaw"><span class="toc-text">A fatal flaw</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-5-rdt2-1"><span class="toc-text">3.4.5 rdt2.1</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#discussion"><span class="toc-text">discussion</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-6-rdt2-2"><span class="toc-text">3.4.6 rdt2.2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-7-rdt3-0"><span class="toc-text">3.4.7 rdt3.0</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#action"><span class="toc-text">action</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Performance"><span class="toc-text">Performance</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#stop-and-wait-operation"><span class="toc-text">stop-and-wait operation</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-8-Pipelined-protocols"><span class="toc-text">3.4.8 Pipelined protocols</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#increased-utilization"><span class="toc-text">increased utilization</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#overview"><span class="toc-text">overview:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Go-Back-N"><span class="toc-text">Go-Back-N:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Selective-repeat"><span class="toc-text">Selective repeat</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-connection-oriented-transport-TCP"><span class="toc-text">3.5 connection-oriented transport: TCP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-1-Overview"><span class="toc-text">3.5.1 Overview</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-2-segment-structure"><span class="toc-text">3.5.2  segment structure</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#TCP-seq-numbers-ACKs"><span class="toc-text">TCP seq. numbers, ACKs</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#round-trip-time-timeout"><span class="toc-text">round trip time, timeout</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-3-reliable-data-transfer"><span class="toc-text">3.5.3 reliable data transfer</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#sender-events"><span class="toc-text">sender events:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Three-retransmission-scenarios"><span class="toc-text">Three retransmission scenarios</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ACK-generation"><span class="toc-text">ACK generation</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#fast-retransmit"><span class="toc-text">fast retransmit</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-4-flow-control"><span class="toc-text">3.5.4 flow control</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-5-Connection-Management"><span class="toc-text">3.5.5 Connection Management</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Handshake"><span class="toc-text">Handshake</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#2-way-handshake"><span class="toc-text">2-way handshake:</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#3-way-handshake"><span class="toc-text">3-way handshake</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#closing-a-connection"><span class="toc-text">closing a connection</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-principles-of-congestion-control"><span class="toc-text">3.6 principles of congestion control</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6-1-Causes-x2F-costs-of-congestion"><span class="toc-text">3.6.1 Causes&#x2F;costs of congestion</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#scenario-1%EF%BC%9A"><span class="toc-text">scenario 1：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#scenario-2%EF%BC%9A"><span class="toc-text">scenario 2：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#scenario-3"><span class="toc-text">scenario 3:</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-TCP-congestion-control"><span class="toc-text">3.7 TCP congestion control</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-7-1-additive-increase-multiplicative-decrease"><span class="toc-text">3.7.1 additive increase multiplicative decrease</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-7-2-details"><span class="toc-text">3.7.2 details</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-7-3-Slow-Start"><span class="toc-text">3.7.3 Slow Start</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Detecting-reacting-to-loss"><span class="toc-text">Detecting, reacting to loss</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#switching-from-slow-start-to-CA"><span class="toc-text">switching from slow start to CA</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#summary"><span class="toc-text">summary</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-7-4-throughput"><span class="toc-text">3.7.4 throughput</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-8-Fairness"><span class="toc-text">3.8 Fairness</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-8-1-Why-is-TCP-fair"><span class="toc-text">3.8.1 Why is TCP fair</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-8-2-More-about-Fairness"><span class="toc-text">3.8.2 More about Fairness</span></a></li></ol></li></ol></li></ol></li></ol> -->
        <div class="toc"></div>
      </div>
    </div>
  </div>
</section>
<!-- 手机端目录按钮 -->
<div id="toc-mobile-btn">
  <i class="fas fa-list-ul" aria-hidden="true"></i>
</div>

      
  <section class="widget side_recent_post">
    
  <header>
    
      <a style="color: " href='/tags/'><i class="fas fa-book fa-fw" aria-hidden="true"></i><span class='name'>最新文章</span></a>
    
  </header>


    <div class='content'>
      
      <!-- hash算法 -->
      
      <div class="aside-list">
        
          <div class="aside-list-item">
            
            
            

            <div class="post-img-box">
              <a href="/2023/05/12/JUC/" class="post-img " style="background-size: cover; 
                background-position: center center;">
                <img class="lazyload lazyload placeholder" style="width:100%;height:100%;object-fit:cover;" data-src="https://picx.zhimg.com/80/v2-b44931ea513e5f7b3b06f2703f79653c_1440w.webp" class="lazyload placeholder" data-srcset="https://picx.zhimg.com/80/v2-b44931ea513e5f7b3b06f2703f79653c_1440w.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="">
              </a>
            </div>
            <div class="post-date-title">
              <div>
                
                  <span class="post-date">05-12</span>
                
              </div>
              <a class="post-title" href="/2023/05/12/JUC/">JUC</a>
            </div>
          </div>
        
          <div class="aside-list-item">
            
            
            

            <div class="post-img-box">
              <a href="/2023/04/07/srping-auto-configration/" class="post-img " style="background-size: cover; 
                background-position: center center;">
                <img class="lazyload lazyload placeholder" style="width:100%;height:100%;object-fit:cover;" data-src="https://pica.zhimg.com/80/v2-573ac3e25de03fad9c32add5a05e5cfc_1440w.webp" class="lazyload placeholder" data-srcset="https://pica.zhimg.com/80/v2-573ac3e25de03fad9c32add5a05e5cfc_1440w.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="">
              </a>
            </div>
            <div class="post-date-title">
              <div>
                
                  <span class="post-date">04-07</span>
                
              </div>
              <a class="post-title" href="/2023/04/07/srping-auto-configration/">srping auto configration</a>
            </div>
          </div>
        
          <div class="aside-list-item">
            
            
            

            <div class="post-img-box">
              <a href="/2022/03/20/spring/" class="post-img " style="background-size: cover; 
                background-position: center center;">
                <img class="lazyload lazyload placeholder" style="width:100%;height:100%;object-fit:cover;" data-src="https://pic2.zhimg.com/80/v2-29e78b52051ce542adf6d786d61fbd19_1440w.webp" class="lazyload placeholder" data-srcset="https://pic2.zhimg.com/80/v2-29e78b52051ce542adf6d786d61fbd19_1440w.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="">
              </a>
            </div>
            <div class="post-date-title">
              <div>
                
                  <span class="post-date">03-20</span>
                
              </div>
              <a class="post-title" href="/2022/03/20/spring/">spring核心基础</a>
            </div>
          </div>
        
          <div class="aside-list-item">
            
            
            

            <div class="post-img-box">
              <a href="/2022/03/03/latex/" class="post-img " style="background-size: cover; 
                background-position: center center;">
                <img class="lazyload lazyload placeholder" style="width:100%;height:100%;object-fit:cover;" data-src="https://picx.zhimg.com/80/v2-9c50d3af0bc62a0e8b6e89e24c769317_1440w.webp" class="lazyload placeholder" data-srcset="https://picx.zhimg.com/80/v2-9c50d3af0bc62a0e8b6e89e24c769317_1440w.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="">
              </a>
            </div>
            <div class="post-date-title">
              <div>
                
                  <span class="post-date">03-03</span>
                
              </div>
              <a class="post-title" href="/2022/03/03/latex/">latex</a>
            </div>
          </div>
        
          <div class="aside-list-item">
            
            
            

            <div class="post-img-box">
              <a href="/2022/03/03/Database-system-C2/" class="post-img " style="background-size: cover; 
                background-position: center center;">
                <img class="lazyload lazyload placeholder" style="width:100%;height:100%;object-fit:cover;" data-src="https://pica.zhimg.com/80/v2-573ac3e25de03fad9c32add5a05e5cfc_1440w.webp" class="lazyload placeholder" data-srcset="https://pica.zhimg.com/80/v2-573ac3e25de03fad9c32add5a05e5cfc_1440w.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="">
              </a>
            </div>
            <div class="post-date-title">
              <div>
                
                  <span class="post-date">03-03</span>
                
              </div>
              <a class="post-title" href="/2022/03/03/Database-system-C2/">Database system(C2)</a>
            </div>
          </div>
        
      </div>
    </div>
  </section>

    
  </div>
</aside>

  <!-- 图片放大 Wrap images with fancybox support -->
  <script src="/js/wrapImage.js"></script>
</div>

<!-- 文章详情页背景图 -->
<div id="appBgSwiper" style="position: fixed;left: 0;top: 0;width: 100%;height: 100%;z-index: -2;"
	:style="{'background-color': bgColor ? bgColor : 'transparent'}">
	<transition-group tag="ul" :name="names">
		<li v-for='(image,index) in img' :key='index' v-show="index === mark" class="bg-swiper-box">
			<img :src="image" class="bg-swiper-img no-lazy">
		</li>
	</transition-group>
</div>
<script>
	var vm = new Vue({
		el: '#appBgSwiper',
		data: {
			names: '' || 'fade' || 'fade', // translate-fade fade
			mark: 0,
			img: [],
			bgColor: '',
			time: null
		},
		methods: {   //添加方法
			change(i, m) {
				if (i > m) {
					// this.names = 'fade';
				} else if (i < m) {
					// this.names = 'fade';
				} else {
					return;
				}
				this.mark = i;
			},
			prev() {
				// this.names = 'fade';
				this.mark--;
				if (this.mark === -1) {
					this.mark = 3;
					return
				}
			},
			next() {
				// this.names = 'fade';
				this.mark++;
				if (this.mark === this.img.length) {
					this.mark = 0;
					return
				}
			},
			autoPlay() {
				// this.names = 'fade';
				this.mark++;
				if (this.mark === this.img.length) {
					this.mark = 0;
					return
				}
			},
			play() {
				let bgImgDelay = '' || '180000'
				let delay = parseInt(bgImgDelay) || 180000;
				this.time = setInterval(this.autoPlay, delay);
			},
			enter() {
				clearInterval(this.time);
			},
			leave() {
				this.play();
			}
		},
		created() {
			this.play()
		},
		beforeDestroy() {
			clearInterval(this.time);
		},
		mounted() {
			let prop = '' || '';
			let isImg = prop.includes('.bmp') || prop.includes('.jpg') || prop.includes('.png') || prop.includes('.tif') || prop.includes('.gif') || prop.includes('.pcx') || prop.includes('.tga') || prop.includes('.exif') || prop.includes('.fpx') || prop.includes('.psd') || prop.includes('.cdr') || prop.includes('.pcd') || prop.includes('.dxf') || prop.includes('.ufo') || prop.includes('.eps') || prop.includes('.ai') || prop.includes('.raw') || prop.includes('.WMF') || prop.includes('.webp') || prop.includes('.jpeg') || prop.includes('http://') || prop.includes('https://')
			if (isImg) {
				let img = prop.split(',');
				let configRoot = '/'
				let arrImg = [];
				img.forEach(el => {
					var Expression = /http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- .\/?%&=]*)?/;
					var objExp = new RegExp(Expression);

					if (objExp.test(el)) {
						// http or https
						arrImg.push(el);
					} else {
						// 非http or https开头
						// 本地文件
						let firstStr = el.charAt(0);
						if (firstStr == '/') {
							el = el.substr(1); // 删除第一个字符 '/',因为 configRoot最后一个字符为 /
						}
						el = configRoot + el;
						arrImg.push(el);
					}
				})
				this.img = arrImg;
			} else {
				this.bgColor = prop;
			}
		}
	})
</script>

<style>
	.bg-swiper-box {
		position: absolute;
		display: block;
		width: 100%;
		height: 100%;
	}

	.bg-swiper-img {
		object-fit: cover;
		width: 100%;
		height: 100%;
	}
</style>




  <script>
  function loadMermaid() {
    if (document.getElementsByClassName('mermaid').length) {
      if (window.mermaidJsLoad) mermaid.init()
      else {
        loadScript('https://unpkg.com/mermaid/dist/mermaid.min.js').then(() => {
          window.mermaidJsLoad = true
          mermaid.initialize({
            theme: 'default',
          })
          if ('true') {
            mermaid.init();
          }
        })
      }
    }
  };
  document.addEventListener("DOMContentLoaded", function () {
    loadMermaid();
  })

  document.addEventListener('pjax:complete', function () {
    loadMermaid();
  })
  
</script>


      </main>
    </div>

    <!-- 页脚 -->
    
  
  
    <!-- 底部鱼儿跳动效果，依赖于jquery-->
<div id="j-fish-skip" style=" position: relative;height: 153px;width: auto;"></div>
<script>
  var RENDERER = {
    POINT_INTERVAL: 5,
    FISH_COUNT: 3,
    MAX_INTERVAL_COUNT: 50,
    INIT_HEIGHT_RATE: .5,
    THRESHOLD: 50,
    FISH_COLOR: '',
    init: function () {
      this.setFishColor(); this.setParameters(), this.reconstructMethods(), this.setup(), this.bindEvent(), this.render()
    },
    setFishColor: function () {
      let isDark = JSON.parse(localStorage.getItem('dark')) || JSON.parse('false');
      if (isDark) {
        this.FISH_COLOR = '#222'; // 暗黑色，有时间把这整成一个变量
      } else {
        this.FISH_COLOR = '' || 'rgba(66, 185, 133, 0.8)';
      }
    },
    setParameters: function () {
      this.$window = $(window), this.$container = $("#j-fish-skip"), this.$canvas = $("<canvas />"), this.context = this.$canvas.appendTo(this.$container).get(0).getContext("2d"), this.points = [], this.fishes = [], this.watchIds = []
    },
    createSurfacePoints: function () {
      var t = Math.round(this.width / this.POINT_INTERVAL);
      this.pointInterval = this.width / (t - 1), this.points.push(new SURFACE_POINT(this, 0));
      for (var i = 1; i < t; i++) {
        var e = new SURFACE_POINT(this, i * this.pointInterval),
          h = this.points[i - 1];
        e.setPreviousPoint(h), h.setNextPoint(e), this.points.push(e)
      }
    },
    reconstructMethods: function () {
      this.watchWindowSize = this.watchWindowSize.bind(this), this.jdugeToStopResize = this.jdugeToStopResize.bind(this), this.startEpicenter = this.startEpicenter.bind(this), this.moveEpicenter = this.moveEpicenter.bind(this), this.reverseVertical = this.reverseVertical.bind(this), this.render = this.render.bind(this)
    },
    setup: function () {
      this.points.length = 0, this.fishes.length = 0, this.watchIds.length = 0, this.intervalCount = this.MAX_INTERVAL_COUNT, this.width = this.$container.width(), this.height = this.$container.height(), this.fishCount = this.FISH_COUNT * this.width / 500 * this.height / 500, this.$canvas.attr({
        width: this.width,
        height: this.height
      }), this.reverse = !1, this.fishes.push(new FISH(this)), this.createSurfacePoints()
    },
    watchWindowSize: function () {
      this.clearTimer(), this.tmpWidth = this.$window.width(), this.tmpHeight = this.$window.height(), this.watchIds.push(setTimeout(this.jdugeToStopResize, this.WATCH_INTERVAL))
    },
    clearTimer: function () {
      for (; this.watchIds.length > 0;) clearTimeout(this.watchIds.pop())
    },
    jdugeToStopResize: function () {
      var t = this.$window.width(),
        i = this.$window.height(),
        e = t == this.tmpWidth && i == this.tmpHeight;
      this.tmpWidth = t, this.tmpHeight = i, e && this.setup()
    },
    bindEvent: function () {
      this.$window.on("resize", this.watchWindowSize), this.$container.on("mouseenter", this.startEpicenter), this.$container.on("mousemove", this.moveEpicenter)
    },
    getAxis: function (t) {
      var i = this.$container.offset();
      return {
        x: t.clientX - i.left + this.$window.scrollLeft(),
        y: t.clientY - i.top + this.$window.scrollTop()
      }
    },
    startEpicenter: function (t) {
      this.axis = this.getAxis(t)
    },
    moveEpicenter: function (t) {
      var i = this.getAxis(t);
      this.axis || (this.axis = i), this.generateEpicenter(i.x, i.y, i.y - this.axis.y), this.axis = i
    },
    generateEpicenter: function (t, i, e) {
      if (!(i < this.height / 2 - this.THRESHOLD || i > this.height / 2 + this.THRESHOLD)) {
        var h = Math.round(t / this.pointInterval);
        h < 0 || h >= this.points.length || this.points[h].interfere(i, e)
      }
    },
    reverseVertical: function () {
      this.reverse = !this.reverse;
      for (var t = 0, i = this.fishes.length; t < i; t++) this.fishes[t].reverseVertical()
    },
    controlStatus: function () {
      for (var t = 0, i = this.points.length; t < i; t++) this.points[t].updateSelf();
      for (t = 0, i = this.points.length; t < i; t++) this.points[t].updateNeighbors();
      this.fishes.length < this.fishCount && 0 == --this.intervalCount && (this.intervalCount = this.MAX_INTERVAL_COUNT, this.fishes.push(new FISH(this)))
    },
    render: function () {
      requestAnimationFrame(this.render), this.controlStatus(), this.context.clearRect(0, 0, this.width, this.height), this.context.fillStyle = this.FISH_COLOR;
      for (var t = 0, i = this.fishes.length; t < i; t++) this.fishes[t].render(this.context);
      this.context.save(), this.context.globalCompositeOperation = "xor", this.context.beginPath(), this.context.moveTo(0, this.reverse ? 0 : this.height);
      for (t = 0, i = this.points.length; t < i; t++) this.points[t].render(this.context);
      this.context.lineTo(this.width, this.reverse ? 0 : this.height), this.context.closePath(), this.context.fill(), this.context.restore()
    }
  },
  SURFACE_POINT = function (t, i) {
    this.renderer = t, this.x = i, this.init()
  };
  SURFACE_POINT.prototype = {
    SPRING_CONSTANT: .03,
    SPRING_FRICTION: .9,
    WAVE_SPREAD: .3,
    ACCELARATION_RATE: .01,
    init: function () {
      this.initHeight = this.renderer.height * this.renderer.INIT_HEIGHT_RATE, this.height = this.initHeight, this.fy = 0, this.force = {
        previous: 0,
        next: 0
      }
    },
    setPreviousPoint: function (t) {
      this.previous = t
    },
    setNextPoint: function (t) {
      this.next = t
    },
    interfere: function (t, i) {
      this.fy = this.renderer.height * this.ACCELARATION_RATE * (this.renderer.height - this.height - t >= 0 ? -1 : 1) * Math.abs(i)
    },
    updateSelf: function () {
      this.fy += this.SPRING_CONSTANT * (this.initHeight - this.height), this.fy *= this.SPRING_FRICTION, this.height += this.fy
    },
    updateNeighbors: function () {
      this.previous && (this.force.previous = this.WAVE_SPREAD * (this.height - this.previous.height)), this.next && (this.force.next = this.WAVE_SPREAD * (this.height - this.next.height))
    },
    render: function (t) {
      this.previous && (this.previous.height += this.force.previous, this.previous.fy += this.force.previous), this.next && (this.next.height += this.force.next, this.next.fy += this.force.next), t.lineTo(this.x, this.renderer.height - this.height)
    }
  };
  var FISH = function (t) {
    this.renderer = t, this.init()
  };
  FISH.prototype = {
    GRAVITY: .4,
    init: function () {
      this.direction = Math.random() < .5, this.x = this.direction ? this.renderer.width + this.renderer.THRESHOLD : -this.renderer.THRESHOLD, this.previousY = this.y, this.vx = this.getRandomValue(4, 10) * (this.direction ? -1 : 1), this.renderer.reverse ? (this.y = this.getRandomValue(1 * this.renderer.height / 10, 4 * this.renderer.height / 10), this.vy = this.getRandomValue(2, 5), this.ay = this.getRandomValue(.05, .2)) : (this.y = this.getRandomValue(6 * this.renderer.height / 10, 9 * this.renderer.height / 10), this.vy = this.getRandomValue(-5, -2), this.ay = this.getRandomValue(-.2, -.05)), this.isOut = !1, this.theta = 0, this.phi = 0
    },
    getRandomValue: function (t, i) {
      return t + (i - t) * Math.random()
    },
    reverseVertical: function () {
      this.isOut = !this.isOut, this.ay *= -1
    },
    controlStatus: function (t) {
      this.previousY = this.y, this.x += this.vx, this.y += this.vy, this.vy += this.ay, this.renderer.reverse ? this.y > this.renderer.height * this.renderer.INIT_HEIGHT_RATE ? (this.vy -= this.GRAVITY, this.isOut = !0) : (this.isOut && (this.ay = this.getRandomValue(.05, .2)), this.isOut = !1) : this.y < this.renderer.height * this.renderer.INIT_HEIGHT_RATE ? (this.vy += this.GRAVITY, this.isOut = !0) : (this.isOut && (this.ay = this.getRandomValue(-.2, -.05)), this.isOut = !1), this.isOut || (this.theta += Math.PI / 20, this.theta %= 2 * Math.PI, this.phi += Math.PI / 30, this.phi %= 2 * Math.PI), this.renderer.generateEpicenter(this.x + (this.direction ? -1 : 1) * this.renderer.THRESHOLD, this.y, this.y - this.previousY), (this.vx > 0 && this.x > this.renderer.width + this.renderer.THRESHOLD || this.vx < 0 && this.x < -this.renderer.THRESHOLD) && this.init()
    },
    render: function (t) {
      t.save(), t.translate(this.x, this.y), t.rotate(Math.PI + Math.atan2(this.vy, this.vx)), t.scale(1, this.direction ? 1 : -1), t.beginPath(), t.moveTo(-30, 0), t.bezierCurveTo(-20, 15, 15, 10, 40, 0), t.bezierCurveTo(15, -10, -20, -15, -30, 0), t.fill(), t.save(), t.translate(40, 0), t.scale(.9 + .2 * Math.sin(this.theta), 1), t.beginPath(), t.moveTo(0, 0), t.quadraticCurveTo(5, 10, 20, 8), t.quadraticCurveTo(12, 5, 10, 0), t.quadraticCurveTo(12, -5, 20, -8), t.quadraticCurveTo(5, -10, 0, 0), t.fill(), t.restore(), t.save(), t.translate(-3, 0), t.rotate((Math.PI / 3 + Math.PI / 10 * Math.sin(this.phi)) * (this.renderer.reverse ? -1 : 1)), t.beginPath(), this.renderer.reverse ? (t.moveTo(5, 0), t.bezierCurveTo(10, 10, 10, 30, 0, 40), t.bezierCurveTo(-12, 25, -8, 10, 0, 0)) : (t.moveTo(-5, 0), t.bezierCurveTo(-10, -10, -10, -30, 0, -40), t.bezierCurveTo(12, -25, 8, -10, 0, 0)), t.closePath(), t.fill(), t.restore(), t.restore(), this.controlStatus(t)
    }
  }, $(function () {
    RENDERER.init()
    $('.dark').click(function () {
      setTimeout(() => {
        RENDERER.setFishColor();
        RENDERER.context.fill();
      });
    })
  });
</script>
  
  <div class="footer bg-color">
    <div class="footer-main">
      
        
          <div class="link">
            
          </div>
        
      
        
          <div class="footer-copyright">
            <p>Powered by <a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/docs/">Hexo</a> | Theme <a target="_blank" rel="noopener" href="https://github.com/yuang01/theme">Bamboo</a> </p>

          </div>
        
      
        
          
            <!-- 不蒜子统计 -->
            <!-- 不蒜子统计 -->
<span id="busuanzi_container_site_pv">
      <i class="fas fa-eye" aria-hidden="true"></i>本站总访问量：<span id="busuanzi_value_site_pv"></span> 次
</span>
<span class="post-meta-divider">|</span>
<span id="busuanzi_container_site_uv" style='display:none'>
      <i class="fas fa-users" aria-hidden="true"></i>本站访客数：<span id="busuanzi_value_site_uv"></span> 人
</span>

          
        
      
        
          <div class="footer-custom">
            
          </div>
        
      
    </div>
  </div>



    <!-- 渲染暗黑按钮 -->
    
      <div class="dark">
  <div class="dark-content">
    <i class="fas fa-moon" aria-hidden="true"></i>
    <!-- <span>关灯</span> -->
  </div>
  
</div>

<script>
  $(function() {
    let isDark = JSON.parse(localStorage.getItem('dark'))  || JSON.parse('false');
    if (isDark) {
      $(".dark-content").replaceWith(
          `
          <div class='dark-content'>
            <i class="fas fa-lightbulb" aria-hidden="true"></i>
          </div>
          `
        );
    }
    $('.dark').click(function() {
      if ($(document.body).is('.darkModel')) {
        $(document.body).removeClass('darkModel');
        localStorage.setItem('dark', false);
        $(".dark-content").replaceWith(
          `
          <div class='dark-content'>
            <i class="fas fa-moon" aria-hidden="true"></i>
          </div>
          `
        );
      } else {
        $(document.body).addClass('darkModel');
        localStorage.setItem('dark', true);
        $(".dark-content").replaceWith(
          `
          <div class='dark-content'>
            <i class="fas fa-lightbulb" aria-hidden="true"></i>
          </div>
          `
        );
      }
    })
  })
</script>
    
    <!-- 渲染回到顶部按钮 -->
    
      <div class="goTop top-btn-color" pointer>
  <i class="fas fa-arrow-up" aria-hidden="true"></i>
</div>
<script src="/js/goTop.js"></script>

    
    <!-- 渲染左下角音乐播放器 -->
    

    <!-- 图片放大 -->
    
      <script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.umd.js"></script>
    

    <!-- 百度解析 -->
    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <!-- 背景彩带 -->
    
      <script type="text/javascript" size="100" alpha='0.4' zIndex="-1" src="/js/ribbon.min.js"></script>
    

    <script src="/js/utils/index.js"></script>
    <script src="/js/app.js"></script>
    
    <!-- 文章目录所需js -->
<!-- <link href="/js/tocbot/tocbot.css" rel="stylesheet">
<script src="/js/tocbot/tocbot.min.js"></script> -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.18.2/tocbot.min.js"></script>


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.18.2/tocbot.css">

<script>
  var headerEl = 'h2, h3, h4',  //headers 
    content = '.post-detail',//文章容器
    idArr = {};  //标题数组以确定是否增加索引id
  //add #id
  var option = {
    // Where to render the table of contents.
    tocSelector: '.toc',
    // Where to grab the headings to build the table of contents.
    contentSelector: content,
    // Which headings to grab inside of the contentSelector element.
    headingSelector: headerEl,
    scrollSmooth: true,
    scrollSmoothOffset: -70,
    // headingsOffset: -($(window).height() * 0.4 - 45),
    headingsOffset: -($(window).height() * 0.4 - 70),
    // positionFixedSelector: '.toc-main',
    // positionFixedClass: 'is-position-fixed',
    fixedSidebarOffset: 'auto',
    activeLinkClass: 'is-active-link',
    orderedList: true,
    collapseDepth: 20,
    // onClick: function (e) {},
  }
  if ($('.toc').length > 0) {

    $(content).children(headerEl).each(function () {
      //去除空格以及多余标点
      var headerId = $(this).text().replace(/[\s|\~|`|\!|\@|\#|\$|\%|\^|\&|\*|\(|\)|\_|\+|\=|\||\|\[|\]|\{|\}|\;|\:|\"|\'|\,|\<|\.|\>|\/|\?|\：|\，|\。]/g, '');

      headerId = headerId.toLowerCase();
      if (idArr[headerId]) {
        //id已经存在
        $(this).attr('id', headerId + '-' + idArr[headerId]);
        idArr[headerId]++;
      }
      else {
        //id未存在
        idArr[headerId] = 1;
        $(this).attr('id', headerId);
      }
    });

    document.addEventListener("DOMContentLoaded", function () {
      tocbot.init(option);
      mobileTocClick();
    });

  }

  window.tocScrollFn = function () {
    return bamboo.throttle(function () {
      findHeadPosition();
    }, 100)()
  }
  window.addEventListener('scroll', tocScrollFn);

  const findHeadPosition = function (top) {
    if ($('.toc-list').length <= 0) {
      return false;
    }
    setTimeout(() => {  // or DOMContentLoaded 
      autoScrollToc();
    }, 0);
  }

  const autoScrollToc = function () {
    const $activeItem = document.querySelector('.is-active-link');
    const $cardToc = document.querySelector('.toc-content');
    const activePosition = $activeItem.getBoundingClientRect().top
    const sidebarScrollTop = $cardToc.scrollTop
    if (activePosition > (document.documentElement.clientHeight - 100)) {
      $cardToc.scrollTop = sidebarScrollTop + 150
    }
    if (activePosition < 150) {
      $cardToc.scrollTop = sidebarScrollTop - 150
    }
  }

  document.addEventListener('pjax:send', function () {
    if ($('.toc').length) {
      tocbot.destroy();
    }
  });

  document.addEventListener('pjax:complete', function () {
    if ($('.toc').length) {
      tocbot.init(option);
      mobileTocClick();
    }
  });
  
  // 手机端toc按钮点击出现目录
  const mobileTocClick = function () {
    const $cardTocLayout = document.getElementsByClassName('side_toc')[0];
    const $cardToc = $cardTocLayout.getElementsByClassName('toc-content')[0];
    let right = '45px';
    if (window.innerWidth >= 551 && window.innerWidth <= 992) {
      right = '100px'
    }
    const mobileToc = {
      open: () => {
        $cardTocLayout.style.cssText = 'animation: toc-open .3s; opacity: 1; right: ' + right
      },

      close: () => {
        $cardTocLayout.style.animation = 'toc-close .2s'
        setTimeout(() => {
          $cardTocLayout.style.cssText = "opacity:''; animation: ''; right: ''"
        }, 100)
      }
    }
    document.getElementById('toc-mobile-btn').addEventListener('click', () => {
      if (window.getComputedStyle($cardTocLayout).getPropertyValue('opacity') === '0') mobileToc.open()
      else mobileToc.close()
    })

    $cardToc.addEventListener('click', (e) => {
      if (window.innerWidth < 992) { // 小于992px的时候
        mobileToc.close()
      }
    })
  }
</script>

<style>
  /* .is-position-fixed {
    position: sticky !important;
    top: 74px;
  }

  .toc-main ul {
    counter-reset: show-list;
  }

  .toc-main ul li::before {
    content: counter(item)".";
    display: block;
    position: absolute;
    left: 12px;
    top: 0;
  } */
</style>
 

<!-- 设置导航背景 -->
<script>
  let setHeaderClass = () => {
    const nav = $('#navHeader');
    const navTop = nav.outerHeight();
    const winTop = $(window).scrollTop();
    if(winTop > navTop) {
      nav.addClass('header-bg-color');
    }
    else {
      nav.removeClass('header-bg-color');
    }
  };

  let scrollCollect = () => {
    return bamboo.throttle(function (e) {
      setHeaderClass();
    }, 200)()
  }

  let initHeaderBg = () => {
    setHeaderClass();
  }

  setHeaderClass();
  window.addEventListener('scroll', scrollCollect);

  document.addEventListener('pjax:send', function () {
    window.removeEventListener('scroll', scrollCollect)
  })
  document.addEventListener('pjax:complete', function () {
    window.addEventListener('scroll', scrollCollect);
    setHeaderClass();
  })
</script> 

<!-- 渲染issues标签里的内容 -->
<script>
  function loadIssuesJS() {
    if ($(".post-detail").find(".issues-api").length == 0) {
      return;
    } 
    loadScript('/js/issues/index.js');
  };
  $(function () {
    loadIssuesJS();
  });
  document.addEventListener('pjax:complete', function () {
    if (typeof IssuesAPI == "undefined") {
      loadIssuesJS();
    }
  })
</script>

<!-- 渲染远程json加载的图片标签(getPhotoOnline)里的内容 -->
<script>
  function loadPhotoOnlineJS() {
    if ($(".post-detail").find(".getJsonPhoto-api").length == 0) {
      return;
    } 
    loadScript('/js/getPhotoOnline/index.js');
  };
  $(function () {
    loadPhotoOnlineJS();
  });
  document.addEventListener('pjax:complete', function () {
    if (typeof getPhotoJson == "undefined") {
      loadPhotoOnlineJS();
    }
  })
</script>

<!-- 渲染远程json加载的talk标签(getTalkOnline)里的内容 -->
<script>
  function loadTalkOnlineJS() {
    if ($(".post-detail").find(".getJsonTalk-api").length == 0) {
      return;
    } 
    loadScript('https://cdnjs.cloudflare.com/ajax/libs/waterfall.js/1.0.2/waterfall.min.js'); // 瀑布流插件，https://raphamorim.io/waterfall.js/
    loadScript('/js/getTalkOnline/index.js');
  };
  $(function () {
    loadTalkOnlineJS();
  });
  document.addEventListener('pjax:complete', function () {
    if (typeof getTalkJson == "undefined") {
      loadTalkOnlineJS();
    }
  })
</script>

<!-- 渲染远程json加载的site-card标签(getSiteOnline)里的内容 -->
<script>
  function loadSiteOnlineJS() {
    if ($(".post-detail").find(".getJsonSite-api").length == 0) {
      return;
    } 
    loadScript('/js/getSiteOnline/index.js');
  };
  $(function () {
    loadSiteOnlineJS();
  });
  document.addEventListener('pjax:complete', function () {
    if (typeof getSiteJson == "undefined") {
      loadSiteOnlineJS();
    }
  })
</script>

<!-- 输入框打字特效 -->
<!-- 输入框打字特效 -->

  <script src="/js/activate-power-mode.js"></script>
  <script>
    POWERMODE.colorful = true;  // 打开随机颜色特效
    POWERMODE.shake = false;    // 关闭输入框抖动
    document.body.addEventListener('input', POWERMODE);//监听打字事件
  </script>


<!-- markdown代码一键复制功能 -->

  <link rel="stylesheet" href="https://unpkg.com/v-plugs-ayu/lib/ayu.css">
  <script src="https://unpkg.com/v-plugs-ayu/lib/ayu.umd.min.js"></script>
  <script src="/js/clipboard/clipboard.min.js"></script>
  <div id="appCopy">
  </div>
  <script data-pjax>
    var vm = new Vue({
      el: '#appCopy',
      data: {
      },
      computed: {
      },
      mounted() {
        const that = this;
        var copy = '复制';
        /* code */
        var initCopyCode = function () {
          var copyHtml = '';
          copyHtml += '<button class="btn-copy" data-clipboard-snippet="" style="position:absolute;top:0;right:0;z-index:1;">';
          copyHtml += '<i class="fas fa-copy"></i><span>' + copy + '</span>';
          copyHtml += '</button>';
          $(".post-detail pre").not('.gutter pre').wrap("<div class='codeBox' style='position:relative;width:100%;'></div>")
          $(".post-detail pre").not('.gutter pre').before(copyHtml);
          new ClipboardJS('.btn-copy', {
            target: function (trigger) {
              return trigger.nextElementSibling;
            }
          });
        }
        initCopyCode();
        $('.btn-copy').unbind('click').bind('click', function () {
          doSomething();
        })
        $(document).unbind('keypress').bind('keypress', function (e) {
          if (e.ctrlKey && e.keyCode == 67) {
            doSomething();
          }
        })

        function doSomething() {
          that.$notify({
            title: "成功",
            content: "代码已复制，请遵守相关授权协议。",
            type: 'success'
          })
        }
      },
      methods: {
      },
      created() { }
    })
  </script>
  

<!-- 图片懒加载 -->
<script defer src="https://unpkg.com/vanilla-lazyload@17.1.0/dist/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazyload",
    threshold: 0
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    lazyLoadInstance.update();
  });
  document.addEventListener('pjax:complete', function () {
    lazyLoadInstance.update();
  });
</script>


<!-- 卡片滚动动画 -->
   

<!-- 评论所需js -->

  
    <script type="text/javascript">
  var utteranceCommon = {};

  function check_utterance() {
    let isDark = JSON.parse(localStorage.getItem('dark')) || JSON.parse('false');
    if (isDark) {
      utteranceCommon.Theme = 'github-dark';
    } else {
      utteranceCommon.Theme = 'github-light';
    }

    return document.getElementById("gitment-container");
  }
  comment_el = '#gitment-container';
  load_utterance = function () {
    if ($(comment_el).length) {
      // 匿名函数，防止污染全局变量
      const HEAD = check_utterance();

      var utterances = document.createElement('script');
      utterances.type = 'text/javascript';
      utterances.async = true;
      utterances.setAttribute('issue-term', 'pathname')
      utterances.setAttribute('theme', utteranceCommon.Theme)
      utterances.setAttribute('repo', '')
      utterances.crossorigin = 'anonymous';
      utterances.src = 'https://utteranc.es/client.js';
      // content 是要插入评论的地方
      document.getElementById('gitment-container').appendChild(utterances);

    }
  }

  function dark_utterance() {
    const HEAD = check_utterance();
    if (!HEAD) return;
    const message = {
      type: 'set-theme',
      theme: utteranceCommon.Theme
    };
    const utteranceIframe = document.querySelector('iframe');
    utteranceIframe.contentWindow.postMessage(message, 'https://utteranc.es');
  }

  $(document).ready(load_utterance);
  document.addEventListener('pjax:complete', function () {
    load_utterance();
  });

  $('.dark').click(function () {
    setTimeout(() => {
      dark_utterance();
    });
  })

</script>

<style>
  .utterances {
    max-width: inherit !important;
  }
</style>
  


<!-- 鼠标点击特效 -->
<!-- 爱心点击 -->

  
    <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 999; pointer-events: none;" ></canvas>
    <script src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script>
    <script src="/js/cursor/explosion.min.js"></script>
  




  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" data-pjax></script>


<!-- 轮播图标签 -->
<script>
  var bambooSwiperTag = {};
  function load_swiper() {
    if (!document.querySelectorAll(".post-swiper-container")[0]) return;
    loadCSS("https://unpkg.com/swiper@6/swiper-bundle.min.css")
    loadScript("https://unpkg.com/swiper@6/swiper-bundle.min.js").then(() => {
      pjax_swiper();
    });
  }

  load_swiper();

  function pjax_swiper() {
    bambooSwiperTag.swiper = new Swiper('.post-swiper-container', {
      slidesPerView: 'auto',
      spaceBetween: 8,
      centeredSlides: true,
      loop: true,
      autoplay: true ? {
        delay: 3000,
        stopOnLastSlide: false,
        disableOnInteraction: false,
      } : false,
      pagination: {
        el: '.swiper-pagination',
        clickable: true,
      },
      navigation: {
        nextEl: '.swiper-button-next',
        prevEl: '.swiper-button-prev',
      },
      on:{
        init: function(){
          swiperAnimateCache(this); //隐藏动画元素 
          swiperAnimate(this); //初始化完成开始动画
        }, 
        slideChangeTransitionEnd: function(){ 
          swiperAnimate(this); //每个slide切换结束时也运行当前slide动画
          //this.slides.eq(this.activeIndex).find('.ani').removeClass('ani'); 动画只展现一次，去除ani类名
        } 
      }
    });
  }

  document.addEventListener('pjax:complete', function () {
    if (!document.querySelectorAll(".post-swiper-container")[0]) return;
    if (typeof bambooSwiperTag.swiper === "undefined") {
      load_swiper();
    } else {
      pjax_swiper();
    }
  });
</script>
    <!-- pjax -->
    

<!-- pjax -->


  <script src="/js/pjax@0.2.8/index.js"></script>
  
    <!-- 样式位于：source/css/_third-party/pjaxanimate.styl -->

<div class="pjax-animate">
  
    <div class="loading-circle"><div id="loader-circle"></div></div>
    <script>
      window.ShowLoading = function() {
        $(".loading-circle").css("display", "block");
      };
      window.HideLoading = function() {
        $(".loading-circle").css("display", "none");
      }
    </script>
  
	<script>
    document.addEventListener('pjax:complete', function () {
      window.HideLoading();
    })
    document.addEventListener('pjax:send', function () {
      window.ShowLoading();
    })
    document.addEventListener('pjax:error', function () {
      window.HideLoading();
    })
	</script>
</div>

  

  <script>
    var pjax = new Pjax({
      elements: 'a[href]:not([href^="#"]):not([href="javascript:void(0)"]):not([no-pjax])',   // 拦截正常带链接的 a 标签
      selectors: ["#pjax-container","title"],                                   // 根据实际需要确认重载区域
      cacheBust: false,   // url 地址追加时间戳，用以避免浏览器缓存
      timeout: 5000
    });

    document.addEventListener('pjax:send', function (e) {

      try {
        var currentUrl = window.location.pathname;
        var targetUrl = e.triggerElement.href;
        var banUrl = [""];
        if (banUrl[0] != "") {
          banUrl.forEach(item => {
            if(currentUrl.indexOf(item) != -1 || targetUrl.indexOf(item) != -1) {
              window.location.href = targetUrl;
            }
          });
        }
      } catch (error) {}

      $(window).unbind('resize');
      $(window).unbind('scroll');
      $(document).unbind('scroll');
      $(document).unbind('click');
      $('body').unbind('click');

    })
    
    document.addEventListener('pjax:complete', function () {
      $('script[data-pjax], .pjax-reload script').each(function () {
        $(this).parent().append($(this).remove());
      });
    });

    document.addEventListener('pjax:error', function (e) {
      window.location.href = e.triggerElement.href;
    })
    
    // 刷新不从顶部开始
    document.addEventListener("DOMContentLoaded", function () {
      history.scrollRestoration = 'auto';
    })
  </script>



  </body>
</html>